<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://booiljung.github.io/linux/ffmpeg/A042/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>하드웨어 가속 설정 - 실험 도서관</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uc774\ub780?", url: "#_top", children: [
          ]},
          {title: "FFmpeg\uc5d0\uc11c \uc9c0\uc6d0\ud558\ub294 \ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \uae30\uc220", url: "#ffmpeg", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uc744 \ud65c\uc6a9\ud55c \uae30\ubcf8 FFmpeg \uba85\ub839\uc5b4", url: "#ffmpeg_1", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \uc635\uc158", url: "#_2", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \uc2dc \uace0\ub824 \uc0ac\ud56d", url: "#_3", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uacfc \uad00\ub828\ub41c \ub9e4\uac1c\ubcc0\uc218", url: "#_4", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \uc778\ucf54\ub529\uc5d0\uc11c\uc758 \ud504\ub808\uc784 \ud06c\uae30", url: "#_5", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \uc778\ucf54\ub529\uc5d0\uc11c\uc758 \ud504\ub808\uc784 \uc18d\ub3c4", url: "#_6", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uacfc \uba54\ubaa8\ub9ac \uad00\ub9ac", url: "#_7", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \ub514\ucf54\ub529", url: "#_8", children: [
          ]},
          {title: "\uc778\ucf54\ub529 \ud488\uc9c8\uacfc \uc18d\ub3c4\uc758 \ud2b8\ub808\uc774\ub4dc\uc624\ud504", url: "#_9", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uacfc \ube44\ud2b8\ub808\uc774\ud2b8 \uc81c\uc5b4", url: "#_10", children: [
              {title: "\uace0\uc815 \ube44\ud2b8\ub808\uc774\ud2b8 (CBR)", url: "#cbr" },
              {title: "\uac00\ubcc0 \ube44\ud2b8\ub808\uc774\ud2b8 (VBR)", url: "#vbr" },
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uacfc \uc0c9\uc0c1 \uacf5\uac04 \ubcc0\ud658", url: "#_11", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uacfc \ud558\ub4dc\uc6e8\uc5b4 \ub514\ucf54\ub354 \uc120\ud0dd", url: "#_12", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d\uacfc \ud558\ub4dc\uc6e8\uc5b4 \uc7a5\uce58 \uc120\ud0dd", url: "#_13", children: [
          ]},
          {title: "\ud558\ub4dc\uc6e8\uc5b4 \uac00\uc18d \uc2dc \uc8fc\uc758\uc0ac\ud56d", url: "#_14", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../js/google_analytics.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="https://www.googletagmanager.com/gtag/js?id=G-3F4LHCTF88"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../A043/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../A043/" class="btn btn-xs btn-link">
        GPU 인코딩/디코딩
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../A041/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../A041/" class="btn btn-xs btn-link">
        무손실 변환
      </a>
    </div>
    
  </div>

    

    <h3 id="_1">하드웨어 가속이란?</h3>
<p>하드웨어 가속은 CPU 대신 GPU 또는 다른 전용 하드웨어를 활용하여 비디오 인코딩 및 디코딩 작업을 처리하는 기술이다. FFmpeg는 다양한 하드웨어 가속 기술을 지원하며, 이를 통해 성능을 극대화하고 처리 시간을 단축할 수 있다.</p>
<h3 id="ffmpeg">FFmpeg에서 지원하는 하드웨어 가속 기술</h3>
<p>FFmpeg는 다음과 같은 하드웨어 가속 기술을 지원한다.</p>
<ol>
<li><strong>NVIDIA NVENC/NVDEC</strong>: NVIDIA GPU의 전용 하드웨어 인코더와 디코더를 사용하여 비디오 처리를 가속화한다.</li>
<li><strong>Intel Quick Sync Video</strong>: Intel CPU에 내장된 하드웨어 인코딩 및 디코딩 기술로, Intel GPU를 통해 비디오 처리 작업을 가속화한다.</li>
<li><strong>AMD VCE (Video Coding Engine)</strong>: AMD GPU에서 지원하는 비디오 인코딩 엔진이다.</li>
<li><strong>VideoToolbox</strong>: Apple의 하드웨어 가속 기술로, macOS 및 iOS에서 하드웨어 기반 인코딩 및 디코딩을 지원한다.</li>
</ol>
<h3 id="ffmpeg_1">하드웨어 가속을 활용한 기본 FFmpeg 명령어</h3>
<p>하드웨어 가속을 설정하려면, <code>-hwaccel</code> 옵션을 사용한다. 예를 들어, NVIDIA GPU를 사용하는 경우 다음과 같이 명령어를 사용할 수 있다:</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -i input.mp4 -c:v h264_nvenc output.mp4
</code></pre>
<p>여기서 <code>-hwaccel cuda</code>는 CUDA 기반의 하드웨어 가속을 활성화하는 옵션이며, <code>-c:v h264_nvenc</code>는 NVIDIA의 H.264 인코더를 사용하도록 설정하는 옵션이다.</p>
<h3 id="_2">하드웨어 가속 옵션</h3>
<p>FFmpeg에서 사용할 수 있는 하드웨어 가속 관련 옵션은 다음과 같다.</p>
<ul>
<li><strong>-hwaccel</strong>: 사용할 하드웨어 가속 기술을 지정하는 옵션. 예를 들어, <code>cuda</code>, <code>qsv</code>, <code>videotoolbox</code> 등을 선택할 수 있다.</li>
<li><strong>-hwaccel_device</strong>: 하드웨어 가속 장치를 선택하는 옵션. 여러 GPU가 있을 때 사용할 GPU를 선택할 수 있다.</li>
<li><strong>-c:v</strong>: 비디오 코덱을 설정하는 옵션. 하드웨어 가속 인코딩을 위해 적절한 코덱을 지정해야 한다.</li>
</ul>
<pre><code class="language-bash">ffmpeg -hwaccel qsv -i input.mp4 -c:v h264_qsv output.mp4
</code></pre>
<p>이 명령어는 Intel Quick Sync Video를 사용하여 비디오를 하드웨어 가속으로 처리하는 예시이다.</p>
<h3 id="_3">하드웨어 가속 시 고려 사항</h3>
<p>하드웨어 가속을 사용할 때 다음과 같은 사항을 고려해야 한다.</p>
<ul>
<li><strong>호환성</strong>: 하드웨어 가속 기능은 특정 하드웨어와 소프트웨어 환경에서만 작동할 수 있다. 따라서, 사용 중인 하드웨어가 FFmpeg와 호환되는지 확인해야 한다.</li>
<li><strong>성능 이점</strong>: 하드웨어 가속은 CPU에 비해 비디오 인코딩 및 디코딩 속도를 크게 향상시킬 수 있지만, 항상 최고의 품질을 보장하지는 않는다. 특히 고품질 비디오 처리가 필요한 경우, 하드웨어 가속보다 소프트웨어 인코딩이 더 나은 선택일 수 있다.</li>
</ul>
<h3 id="_4">하드웨어 가속과 관련된 매개변수</h3>
<p>하드웨어 가속 시 FFmpeg에서 설정할 수 있는 주요 매개변수는 다음과 같다:</p>
<ul>
<li><strong>비트레이트</strong> <span class="arithmatex"><span class="MathJax_Preview">\mathbf{r_b}</span><script type="math/tex">\mathbf{r_b}</script></span>: 하드웨어 인코딩에서 비트레이트는 비디오 품질과 처리 속도에 큰 영향을 미친다. 비트레이트는 다음과 같이 설정할 수 있다.</li>
</ul>
<p><code>bash
  ffmpeg -i input.mp4 -c:v h264_nvenc -b:v 5M output.mp4</code></p>
<p>여기서 <span class="arithmatex"><span class="MathJax_Preview">r_b = 5</span><script type="math/tex">r_b = 5</script></span> Mbps는 인코딩 시 사용할 비트레이트를 나타낸다.</p>
<h3 id="_5">하드웨어 가속 인코딩에서의 프레임 크기</h3>
<p>하드웨어 가속을 사용할 때, 프레임 크기 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{F}</span><script type="math/tex">\mathbf{F}</script></span> 또한 중요한 매개변수이다. 특히, GPU 인코딩은 큰 해상도의 비디오에서 더 큰 성능 향상을 보인다. FFmpeg에서 하드웨어 가속 인코딩 시 프레임 크기를 변경하는 방법은 다음과 같다:</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -i input.mp4 -vf scale=1280:720 -c:v h264_nvenc output.mp4
</code></pre>
<p>위 명령어에서, <code>scale=1280:720</code>은 해상도를 1280x720으로 줄이는 비디오 필터를 의미하며, <span class="arithmatex"><span class="MathJax_Preview">\mathbf{F} = 1280 \times 720</span><script type="math/tex">\mathbf{F} = 1280 \times 720</script></span> 해상도로 출력된다.</p>
<h3 id="_6">하드웨어 가속 인코딩에서의 프레임 속도</h3>
<p>프레임 속도 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{f_r}</span><script type="math/tex">\mathbf{f_r}</script></span>는 비디오 재생의 부드러움에 영향을 미치는 중요한 요소이다. 하드웨어 가속을 사용하여 프레임 속도를 설정하거나 변경할 수 있다. 다음 명령어는 NVIDIA NVENC를 사용하여 60 FPS로 인코딩하는 예시이다.</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -i input.mp4 -r 60 -c:v h264_nvenc output.mp4
</code></pre>
<p>이때 프레임 속도 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{f_r} = 60</span><script type="math/tex">\mathbf{f_r} = 60</script></span> FPS가 적용된다.</p>
<h3 id="_7">하드웨어 가속과 메모리 관리</h3>
<p>하드웨어 가속을 사용할 때 GPU 메모리 관리도 중요한 요소이다. GPU가 처리할 수 있는 데이터의 양은 제한적이기 때문에, 하드웨어 가속 인코딩 시 GPU 메모리 사용량을 최적화하는 것이 필요하다. NVIDIA NVENC의 경우, <code>-gpu</code> 옵션을 사용하여 특정 GPU에서 인코딩을 처리하도록 설정할 수 있다.</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -i input.mp4 -gpu 0 -c:v h264_nvenc output.mp4
</code></pre>
<p>여기서 <code>-gpu 0</code>은 첫 번째 GPU를 사용하겠다는 의미이다.</p>
<h3 id="_8">하드웨어 가속 디코딩</h3>
<p>하드웨어 가속은 인코딩뿐만 아니라 디코딩에도 사용할 수 있다. 하드웨어 가속 디코딩은 특히 고해상도 비디오의 재생 성능을 크게 향상시킬 수 있다. 다음은 NVIDIA NVDEC를 사용하여 비디오를 하드웨어 가속으로 디코딩하는 예시이다.</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -i input.mp4 -c:v h264_cuvid -f null -
</code></pre>
<p>위 명령어는 입력 파일을 GPU에서 디코딩하고 출력 없이 디코딩 성능만 테스트한다. 여기서 <code>-c:v h264_cuvid</code>는 NVIDIA의 하드웨어 기반 H.264 디코더를 사용한다는 의미이다.</p>
<h3 id="_9">인코딩 품질과 속도의 트레이드오프</h3>
<p>하드웨어 가속을 사용할 때 인코딩 품질 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{Q}</span><script type="math/tex">\mathbf{Q}</script></span>와 속도 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{S}</span><script type="math/tex">\mathbf{S}</script></span> 사이의 트레이드오프가 발생할 수 있다. 하드웨어 가속 인코더는 CPU 기반 소프트웨어 인코더보다 빠르지만, 품질은 경우에 따라 떨어질 수 있다. 이때, 다음과 같은 옵션을 사용하여 속도와 품질의 균형을 맞출 수 있다:</p>
<pre><code class="language-bash">ffmpeg -i input.mp4 -c:v h264_nvenc -preset slow -b:v 5M output.mp4
</code></pre>
<p>여기서 <code>-preset slow</code>는 더 높은 품질을 위한 느린 인코딩을 설정한다. <span class="arithmatex"><span class="MathJax_Preview">\mathbf{Q}</span><script type="math/tex">\mathbf{Q}</script></span>는 비트레이트와 프리셋 설정에 따라 달라지며, <span class="arithmatex"><span class="MathJax_Preview">\mathbf{S}</span><script type="math/tex">\mathbf{S}</script></span>는 프리셋 설정에 따라 조정된다.</p>
<h3 id="_10">하드웨어 가속과 비트레이트 제어</h3>
<p>하드웨어 가속 인코딩에서 비트레이트 제어는 중요한 요소 중 하나이다. 비트레이트는 비디오 품질과 파일 크기에 직접적인 영향을 미치며, 고정 비트레이트(CBR) 또는 가변 비트레이트(VBR) 방식을 선택할 수 있다.</p>
<h4 id="cbr">고정 비트레이트 (CBR)</h4>
<p>고정 비트레이트(CBR)를 사용하는 경우, 전체 비디오에서 일정한 비트레이트를 유지하도록 설정할 수 있다. CBR 방식은 예측 가능한 파일 크기와 일정한 네트워크 대역폭 사용을 보장한다. 다음 명령어는 CBR로 하드웨어 가속 인코딩을 설정하는 방법이다:</p>
<pre><code class="language-bash">ffmpeg -i input.mp4 -c:v h264_nvenc -b:v 5000k -minrate 5000k -maxrate 5000k output.mp4
</code></pre>
<p>위 명령어에서 <code>-b:v 5000k</code>, <code>-minrate 5000k</code>, <code>-maxrate 5000k</code>는 모두 비트레이트를 5000 kbps로 고정한다는 의미이다.</p>
<h4 id="vbr">가변 비트레이트 (VBR)</h4>
<p>가변 비트레이트(VBR)는 비디오 장면에 따라 비트레이트를 유동적으로 변경하여 더 효율적인 인코딩을 가능하게 한다. 복잡한 장면에서는 더 높은 비트레이트를 사용하고, 단순한 장면에서는 낮은 비트레이트를 사용한다. VBR 방식은 다음과 같이 설정할 수 있다:</p>
<pre><code class="language-bash">ffmpeg -i input.mp4 -c:v h264_nvenc -b:v 5000k -maxrate 8000k -bufsize 1000k output.mp4
</code></pre>
<p>여기서 <code>-b:v 5000k</code>는 목표 비트레이트를 설정하고, <code>-maxrate 8000k</code>는 최대 비트레이트를 8000 kbps로 제한하며, <code>-bufsize 1000k</code>는 버퍼 크기를 설정한다.</p>
<h3 id="_11">하드웨어 가속과 색상 공간 변환</h3>
<p>하드웨어 가속 인코딩에서 색상 공간 변환은 필수적인 작업 중 하나이다. 예를 들어, YUV420 색상 공간을 RGB로 변환할 수 있으며, 이는 다음과 같이 FFmpeg 명령어로 설정할 수 있다:</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -i input.mp4 -vf format=yuv420p -c:v h264_nvenc output.mp4
</code></pre>
<p>여기서 <code>-vf format=yuv420p</code>는 비디오 필터를 사용하여 YUV420 색상 공간으로 변환하는 것을 의미한다. 색상 공간 변환은 하드웨어 가속과 병행하여 이루어지며, GPU의 연산 성능을 활용할 수 있다.</p>
<h3 id="_12">하드웨어 가속과 하드웨어 디코더 선택</h3>
<p>하드웨어 가속 디코더를 선택할 때, 특정 하드웨어에 맞는 디코더를 사용해야 한다. 예를 들어, NVIDIA GPU를 사용할 경우 다음과 같은 명령어를 사용하여 NVDEC를 활성화할 수 있다:</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuvid -c:v h264_cuvid -i input.mp4 -c:v h264_nvenc output.mp4
</code></pre>
<p>이 명령어는 <code>-hwaccel cuvid</code>를 사용하여 하드웨어 가속 디코딩을 활성화하고, <code>-c:v h264_cuvid</code>는 NVIDIA의 H.264 하드웨어 디코더를 사용하여 비디오를 디코딩한다. 이후 <code>h264_nvenc</code>를 사용하여 비디오를 다시 인코딩할 수 있다.</p>
<h3 id="_13">하드웨어 가속과 하드웨어 장치 선택</h3>
<p>시스템에 여러 개의 GPU가 장착된 경우, FFmpeg는 특정 GPU를 선택하여 하드웨어 가속을 수행할 수 있다. <code>-gpu</code> 옵션을 사용하여 사용할 GPU를 선택할 수 있으며, 이는 NVIDIA NVENC 인코딩 시 유용하다. 예를 들어, 두 번째 GPU를 사용하려면 다음과 같이 설정할 수 있다:</p>
<pre><code class="language-bash">ffmpeg -hwaccel cuda -gpu 1 -i input.mp4 -c:v h264_nvenc output.mp4
</code></pre>
<p>여기서 <code>-gpu 1</code>은 두 번째 GPU를 사용하겠다는 의미이다.</p>
<h3 id="_14">하드웨어 가속 시 주의사항</h3>
<ol>
<li>
<p><strong>호환성 문제</strong>: 각 하드웨어 가속 기술은 특정 운영 체제 및 하드웨어에서만 지원된다. 예를 들어, Intel Quick Sync Video는 Intel 프로세서에서만 사용할 수 있으며, NVIDIA NVENC는 NVIDIA GPU에서만 작동한다. 사용하려는 하드웨어 가속 기술이 현재 사용 중인 시스템과 호환되는지 확인하는 것이 중요하다.</p>
</li>
<li>
<p><strong>성능 최적화</strong>: 하드웨어 가속 기술을 사용할 때는 각 기술에 맞는 최적의 설정을 사용하는 것이 중요하다. 예를 들어, NVENC는 고속 인코딩에 적합하지만, 소프트웨어 인코딩보다 약간의 품질 손실이 있을 수 있다. 따라서 작업의 요구사항에 맞는 인코딩 방식을 선택하는 것이 필요하다.</p>
</li>
<li>
<p><strong>에러 처리</strong>: 하드웨어 가속을 사용할 때 에러가 발생할 수 있다. 이러한 에러는 보통 드라이버 문제이거나, 하드웨어가 특정 기능을 지원하지 않는 경우가 많다. 이럴 때는 FFmpeg 로그를 확인하여 문제를 해결할 수 있다.</p>
</li>
</ol>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../A043/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../A043/" class="btn btn-xs btn-link">
        GPU 인코딩/디코딩
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../A041/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../A041/" class="btn btn-xs btn-link">
        무손실 변환
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>