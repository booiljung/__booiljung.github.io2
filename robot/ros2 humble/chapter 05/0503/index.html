<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://booiljung.github.io/robot/ros2%20humble/chapter%2005/0503/">
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>퍼블리셔와 서브스크라이버 - 실험 도서관</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <link href="../../../../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\ud37c\ube14\ub9ac\uc154(Publisher)", url: "#_top", children: [
          ]},
          {title: "\uc11c\ube0c\uc2a4\ud06c\ub77c\uc774\ubc84(Subscriber)", url: "#subscriber", children: [
          ]},
          {title: "\ud37c\ube14\ub9ac\uc154\uc640 \uc11c\ube0c\uc2a4\ud06c\ub77c\uc774\ubc84\uc758 \ub3d9\uc791 \uc6d0\ub9ac", url: "#_1", children: [
              {title: "QoS (Quality of Service)", url: "#qos-quality-of-service" },
              {title: "\ud37c\ube14\ub9ac\uc154\uc640 \uc11c\ube0c\uc2a4\ud06c\ub77c\uc774\ubc84\uc758 \ub3d9\uae30\ud654 \ubb38\uc81c", url: "#_2" },
          ]},
          {title: "\ud37c\ube14\ub9ac\uc154\uc640 \uc11c\ube0c\uc2a4\ud06c\ub77c\uc774\ubc84\uc758 \uc2e4\uc81c \uc0ac\ub840", url: "#_3", children: [
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../js/google_analytics.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="https://www.googletagmanager.com/gtag/js?id=G-3F4LHCTF88"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../0504/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../0504/" class="btn btn-xs btn-link">
        서비스와 액션의 개념 및 차이점
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../0502/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../0502/" class="btn btn-xs btn-link">
        싱글 노드와 멀티 노드 차이점
      </a>
    </div>
    
  </div>

    

    <h3 id="publisher">퍼블리셔(Publisher)</h3>
<p>퍼블리셔는 ROS2에서 데이터를 배포하는 역할을 한다. 퍼블리셔는 특정 토픽에 데이터를 게시하며, 해당 토픽을 구독(subscribe)하고 있는 서브스크라이버에게 데이터를 전달한다. 퍼블리셔는 주로 센서 데이터나 상태 정보를 주기적으로 전송하는 데 사용된다.</p>
<p>퍼블리셔를 생성할 때는 특정 메시지 타입을 정의해야 한다. ROS2에서는 다양한 메시지 타입을 제공하며, 이를 통해 텍스트, 숫자, 이미지, 센서 데이터 등의 다양한 형식을 처리할 수 있다. 사용자 정의 메시지도 가능하다.</p>
<p>퍼블리셔를 생성하는 코드의 예시는 다음과 같다.</p>
<pre><code class="language-cpp">rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr publisher = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;(&quot;토픽이름&quot;, 10);
</code></pre>
<p>위 코드에서 퍼블리셔는 "토픽이름"이라는 이름의 토픽으로 데이터를 전송하며, 퍼블리셔가 처리할 수 있는 메시지의 최대 수는 10개이다. 이 값은 큐(queue)의 크기를 나타낸다.</p>
<p>퍼블리셔가 데이터를 전송하는 방식은 아래와 같은 과정을 따른다.
1. 메시지 데이터를 생성한다.
2. 메시지를 퍼블리셔 객체를 통해 전송한다.</p>
<pre><code class="language-cpp">auto message = std_msgs::msg::String();
message.data = &quot;Hello, ROS2!&quot;;
publisher-&gt;publish(message);
</code></pre>
<p>이 예제에서는 "Hello, ROS2!"라는 문자열을 포함한 메시지가 전송된다.</p>
<h3 id="subscriber">서브스크라이버(Subscriber)</h3>
<p>서브스크라이버는 퍼블리셔가 전송하는 데이터를 수신하는 역할을 한다. 서브스크라이버는 특정 토픽을 구독하며, 해당 토픽에 새로운 데이터가 게시되면 이를 받아서 처리한다.</p>
<p>서브스크라이버를 생성할 때는 퍼블리셔가 사용하는 메시지 타입과 동일한 메시지 타입을 사용해야 한다. 예를 들어, 퍼블리셔가 <code>std_msgs::msg::String</code> 타입의 데이터를 전송하면, 서브스크라이버도 동일한 타입을 사용하여야 한다.</p>
<p>서브스크라이버를 생성하는 코드의 예시는 다음과 같다.</p>
<pre><code class="language-cpp">rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr subscriber = this-&gt;create_subscription&lt;std_msgs::msg::String&gt;(&quot;토픽이름&quot;, 10, std::bind(&amp;NodeClass::topic_callback, this, std::placeholders::_1));
</code></pre>
<p>서브스크라이버는 토픽이름이라는 토픽에서 데이터를 구독하며, 콜백 함수 <code>topic_callback</code>을 통해 수신된 데이터를 처리한다.</p>
<pre><code class="language-cpp">void NodeClass::topic_callback(const std_msgs::msg::String::SharedPtr msg) {
    RCLCPP_INFO(this-&gt;get_logger(), &quot;Received: '%s'&quot;, msg-&gt;data.c_str());
}
</code></pre>
<p>이 예제에서는 수신된 메시지의 데이터를 로그로 출력하는 방식으로 처리된다.</p>
<p>서브스크라이버는 ROS2에서 데이터를 수신하고 처리하는 중요한 역할을 하며, 네트워크를 통한 통신 과정에서 필수적인 요소로 작동한다.</p>
<h3 id="_1">퍼블리셔와 서브스크라이버의 동작 원리</h3>
<p>퍼블리셔와 서브스크라이버의 통신은 ROS2의 데이터 분산 서비스(DDS, Data Distribution Service)를 통해 이루어진다. DDS는 퍼블리셔와 서브스크라이버 간의 통신을 추상화하여, 메시지가 네트워크 상에서 투명하게 전달되도록 한다. 이는 퍼블리셔와 서브스크라이버가 서로의 존재를 알지 못해도, 특정 토픽을 통해 데이터를 주고받을 수 있도록 한다.</p>
<p>이러한 방식은 퍼블리셔와 서브스크라이버 간의 결합도를 낮추어, 시스템을 보다 모듈화하고 유연하게 설계할 수 있게 한다. 예를 들어, 다수의 서브스크라이버가 하나의 퍼블리셔로부터 데이터를 구독할 수 있으며, 반대로 여러 퍼블리셔가 동일한 토픽에 데이터를 게시할 수도 있다.</p>
<p>퍼블리셔와 서브스크라이버는 서로 독립적인 프로세스로 동작할 수 있으며, 이는 ROS2의 분산 시스템에서 특히 유용하다. 퍼블리셔와 서브스크라이버는 네트워크의 지연이나 일시적인 연결 끊김에 대한 내성을 가지고 있어, 데이터의 안정적인 전달이 가능하다.</p>
<h4 id="qos-quality-of-service">QoS (Quality of Service)</h4>
<p>퍼블리셔와 서브스크라이버 간의 통신 품질을 제어하기 위해 ROS2는 QoS(서비스 품질) 정책을 제공한다. QoS는 메시지가 어떻게 전송되고 수신될지를 정의하는 정책으로, 주로 네트워크 환경에 따라 메시지의 신뢰성, 전달 보장 여부, 수신 우선 순위 등을 설정할 수 있다.</p>
<p>QoS는 퍼블리셔와 서브스크라이버 각각에서 설정할 수 있으며, 서로 다른 QoS 설정을 사용할 수도 있다. 다음은 QoS의 주요 설정 항목이다.</p>
<ol>
<li><strong>Reliability</strong>: 메시지가 손실 없이 전송되어야 하는지 여부를 설정한다.</li>
<li><code>Reliable</code>: 메시지가 확실히 전달되어야 할 때 사용한다.</li>
<li>
<p><code>Best Effort</code>: 메시지 전달의 신뢰성을 보장하지 않아도 되는 경우 사용한다.</p>
</li>
<li>
<p><strong>Durability</strong>: 퍼블리셔가 메시지를 게시했을 때, 서브스크라이버가 늦게 연결되더라도 이전 메시지를 받을 수 있는지 여부를 설정한다.</p>
</li>
<li><code>Volatile</code>: 새로운 서브스크라이버는 연결 이후부터 게시된 메시지만 받을 수 있다.</li>
<li>
<p><code>Transient Local</code>: 새로운 서브스크라이버도 이전에 게시된 메시지를 받을 수 있다.</p>
</li>
<li>
<p><strong>History</strong>: 퍼블리셔가 게시한 메시지의 기록을 저장할지, 그리고 얼마나 많이 저장할지를 설정한다.</p>
</li>
<li><code>Keep Last</code>: 최근 N개의 메시지를 저장한다.</li>
<li>
<p><code>Keep All</code>: 모든 메시지를 저장한다.</p>
</li>
<li>
<p><strong>Deadline</strong>: 퍼블리셔가 주기적으로 메시지를 게시해야 하는 최대 시간을 설정한다. 만약 이 시간이 초과되면 경고가 발생한다.</p>
</li>
<li>
<p><strong>Liveliness</strong>: 퍼블리셔가 활성 상태임을 보장하기 위한 정책이다. 퍼블리셔가 주기적으로 자신의 존재를 알리는 신호를 보내야 한다.</p>
</li>
</ol>
<p>예시로, 퍼블리셔에서 QoS 설정을 적용하는 방법은 다음과 같다.</p>
<pre><code class="language-cpp">rclcpp::PublisherOptions options;
options.qos.reliability(RMW_QOS_POLICY_RELIABILITY_RELIABLE);
options.qos.history(RMW_QOS_POLICY_HISTORY_KEEP_LAST, 10);
</code></pre>
<p>위 코드에서는 퍼블리셔의 QoS 설정을 신뢰성 있는 메시지 전달(<code>Reliable</code>)과 최근 10개의 메시지 기록 유지로 설정하고 있다.</p>
<h4 id="_2">퍼블리셔와 서브스크라이버의 동기화 문제</h4>
<p>퍼블리셔와 서브스크라이버는 서로 독립적으로 실행되기 때문에, 두 프로세스 간의 동기화 문제가 발생할 수 있다. 특히 퍼블리셔가 서브스크라이버보다 빠르게 메시지를 게시할 경우, 서브스크라이버가 모든 메시지를 처리하지 못하는 상황이 생길 수 있다.</p>
<p>이 문제를 해결하기 위한 방법 중 하나는 메시지 처리 속도를 조절하거나, QoS 설정을 통해 메시지 전달을 보장하는 것이다. 또한, 서브스크라이버가 메시지를 수신할 수 없는 경우를 대비해 퍼블리셔에서 메시지를 버퍼에 저장하고, 이후 서브스크라이버가 준비되었을 때 해당 메시지를 다시 전송하는 방법도 고려할 수 있다.</p>
<h3 id="_3">퍼블리셔와 서브스크라이버의 실제 사례</h3>
<p>퍼블리셔와 서브스크라이버의 개념은 다양한 로봇 시스템에서 널리 사용된다. 예를 들어, 자율 주행 차량에서는 LiDAR, 카메라, GPS 등의 센서로부터 데이터를 퍼블리셔를 통해 전송하고, 해당 데이터를 처리하는 서브스크라이버가 이를 수신하여 주행 경로를 결정한다. </p>
<p>또한, 드론 시스템에서는 고도, 속도, 위치 데이터를 퍼블리셔가 전송하고, 이를 수신한 서브스크라이버가 드론의 비행을 제어하는데 중요한 역할을 한다.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../0504/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../0504/" class="btn btn-xs btn-link">
        서비스와 액션의 개념 및 차이점
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../0502/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../0502/" class="btn btn-xs btn-link">
        싱글 노드와 멀티 노드 차이점
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>