<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://booiljung.github.io/robot/ros2%20humble/chapter%2014/1404/">
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>빌드 및 실행 오류 해결 - 실험 도서관</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <link href="../../../../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uc885\uc18d\uc131 \uad00\ub828 \uc624\ub958", url: "#_top", children: [
              {title: "\ud328\ud0a4\uc9c0 \uc885\uc18d\uc131 \ud574\uacb0 \ubc29\ubc95", url: "#_2" },
              {title: "colcon \ube4c\ub4dc \ub3c4\uad6c \uc124\uc815", url: "#colcon" },
          ]},
          {title: "CMakeLists.txt \uc124\uc815 \uc624\ub958", url: "#cmakeliststxt", children: [
              {title: "CMakeLists.txt \uc124\uc815 \uc608\uc81c", url: "#cmakeliststxt_1" },
              {title: "CMake \ubcc0\uc218 \uc124\uc815 \uc624\ub958", url: "#cmake" },
          ]},
          {title: "\ub7f0\ud0c0\uc784 \uc624\ub958", url: "#_3", children: [
              {title: "\uba54\uc2dc\uc9c0 \ud615\uc2dd \ubd88\uc77c\uce58", url: "#_4" },
          ]},
          {title: "\uc2e4\ud589 \ud30c\uc77c \uad8c\ud55c \uc624\ub958", url: "#_5", children: [
          ]},
          {title: "\ub77c\uc774\ube0c\ub7ec\ub9ac \uacbd\ub85c \uc124\uc815 \uc624\ub958", url: "#_6", children: [
              {title: "LD_LIBRARY_PATH \ud658\uacbd \ubcc0\uc218 \uc124\uc815", url: "#ld_library_path" },
              {title: "\ub77c\uc774\ube0c\ub7ec\ub9ac \uacbd\ub85c \uc9c0\uc815 \uc624\ub958", url: "#_7" },
          ]},
          {title: "ROS2 \ub7f0\uce58 \ud30c\uc77c \uad00\ub828 \uc624\ub958", url: "#ros2", children: [
              {title: "\ub7f0\uce58 \ud30c\uc77c \uc624\ub958 \ud655\uc778 \ubc29\ubc95", url: "#_8" },
          ]},
          {title: "\ud328\ud0a4\uc9c0 \ube4c\ub4dc \uc21c\uc11c \ubb38\uc81c", url: "#_9", children: [
              {title: "\ube4c\ub4dc \uc21c\uc11c \ud574\uacb0 \ubc29\ubc95", url: "#_10" },
          ]},
          {title: "ROS2 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ubc0f \ub9ac\ub9e4\ud551 \uc624\ub958", url: "#ros2_1", children: [
              {title: "\ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc124\uc815 \uc624\ub958 \ud574\uacb0", url: "#_11" },
          ]},
          {title: "ROS2 \uba54\uc2dc\uc9c0 \ube4c\ub4dc \uc624\ub958", url: "#ros2_2", children: [
              {title: "\uba54\uc2dc\uc9c0 \ud30c\uc77c \uc815\uc758 \uc624\ub958", url: "#_12" },
              {title: "\uba54\uc2dc\uc9c0 \ube4c\ub4dc \uc124\uc815", url: "#_13" },
          ]},
          {title: "QoS \uc124\uc815 \uc624\ub958", url: "#qos", children: [
              {title: "QoS \uc124\uc815", url: "#qos_1" },
          ]},
          {title: "\ud658\uacbd \ubcc0\uc218 \uc124\uc815 \uc624\ub958", url: "#_14", children: [
              {title: "\ud658\uacbd \ubcc0\uc218 \uc124\uc815 \ubc29\ubc95", url: "#_15" },
          ]},
          {title: "\ub178\ub4dc \uc885\ub8cc \ud6c4 \uc7ac\uc2dc\uc791 \uc624\ub958", url: "#_16", children: [
              {title: "\ud3ec\ud2b8 \ucda9\ub3cc \ud574\uacb0", url: "#_17" },
          ]},
          {title: "\uc2e4\uc2dc\uac04 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\uc758 \ube4c\ub4dc \ubc0f \uc2e4\ud589 \uc624\ub958", url: "#_18", children: [
              {title: "\uc2a4\ucf00\uc904\ub9c1 \uc815\ucc45 \uc124\uc815", url: "#_19" },
          ]},
          {title: "\ube4c\ub4dc \uce90\uc2dc \ubb38\uc81c", url: "#_20", children: [
              {title: "\ube4c\ub4dc \uce90\uc2dc \uc0ad\uc81c", url: "#_21" },
          ]},
          {title: "\ub178\ub4dc \uc0c1\ud638 \uc885\uc18d\uc131 \ubb38\uc81c", url: "#_22", children: [
              {title: "\ub7f0\uce58 \ud30c\uc77c\uc5d0\uc11c\uc758 \ub178\ub4dc \uc758\uc874\uc131 \uc124\uc815", url: "#_23" },
          ]},
          {title: "ROS2 \ud30c\ub77c\ubbf8\ud130 \uc124\uc815 \uc624\ub958", url: "#ros2_3", children: [
              {title: "\ud30c\ub77c\ubbf8\ud130 \ud0c0\uc785 \ubc0f \ubc94\uc704 \ud655\uc778", url: "#_24" },
          ]},
          {title: "\uc2e4\uc2dc\uac04 \ub178\ub4dc \uc6b0\uc120 \uc21c\uc704 \ubc0f \uc790\uc6d0 \ud560\ub2f9 \ubb38\uc81c", url: "#_25", children: [
              {title: "\uc6b0\uc120 \uc21c\uc704 \ubc0f \uc2a4\ucf00\uc904\ub9c1 \uc815\ucc45 \uc124\uc815", url: "#_26" },
          ]},
          {title: "\ucf5c\ubc31 \uc9c0\uc5f0 \ubc0f \ucc98\ub9ac \uc131\ub2a5 \ubb38\uc81c", url: "#_27", children: [
              {title: "\uba40\ud2f0\uc2a4\ub808\ub529\uc744 \ud1b5\ud55c \ucf5c\ubc31 \ucc98\ub9ac \ucd5c\uc801\ud654", url: "#_28" },
              {title: "\ucf5c\ubc31 \uc9c0\uc5f0 \uc6d0\uc778 \ubd84\uc11d", url: "#_29" },
          ]},
          {title: "\uc2dc\uc2a4\ud15c \uba54\ubaa8\ub9ac \ub204\uc218 \ubb38\uc81c", url: "#_30", children: [
              {title: "\uba54\ubaa8\ub9ac \uad00\ub9ac \ubc0f \ub204\uc218 \ubc29\uc9c0", url: "#_31" },
              {title: "\uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9 \ubaa8\ub2c8\ud130\ub9c1", url: "#_32" },
          ]},
          {title: "\ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ubc0f \ud1b5\uc2e0 \ubb38\uc81c", url: "#_33", children: [
              {title: "\ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \uc81c\uc5b4 \ubc0f \ucd5c\uc801\ud654", url: "#_34" },
              {title: "\ub124\ud2b8\uc6cc\ud06c \uc9c0\uc5f0 \ubc0f \ud328\ud0b7 \uc190\uc2e4 \ud574\uacb0", url: "#_35" },
          ]},
          {title: "ROS2 \uc2e4\ud589 \ud30c\uc77c \ub9c1\ud06c \ubb38\uc81c", url: "#ros2_4", children: [
              {title: "CMakeLists.txt\uc758 \ub9c1\ud06c \ubb38\uc81c \ud574\uacb0", url: "#cmakeliststxt_2" },
              {title: "\ub3d9\uc801 \ub77c\uc774\ube0c\ub7ec\ub9ac \ubb38\uc81c", url: "#_36" },
          ]},
          {title: "\uc2e4\ud589 \ud30c\uc77c \uacbd\ub85c \uc124\uc815 \ubb38\uc81c", url: "#_37", children: [
              {title: "\uc2e4\ud589 \ud30c\uc77c \uacbd\ub85c \uc124\uc815", url: "#_38" },
              {title: "\uc2e4\ud589 \ud30c\uc77c \uc704\uce58 \ud655\uc778", url: "#_39" },
          ]},
          {title: "\ub178\ub4dc \uac04 \ud1b5\uc2e0 \ubd88\uac00 \ubb38\uc81c", url: "#_40", children: [
              {title: "\ud1a0\ud53d \uc774\ub984 \ubd88\uc77c\uce58", url: "#_41" },
              {title: "QoS \uc815\ucc45 \ubd88\uc77c\uce58", url: "#qos_2" },
          ]},
          {title: "\ub7f0\ud0c0\uc784 \ucda9\ub3cc \ubb38\uc81c", url: "#_42", children: [
              {title: "\uba54\ubaa8\ub9ac \uc811\uadfc \uc624\ub958", url: "#_43" },
              {title: "\ub3d9\uc2dc\uc131 \ubb38\uc81c \ud574\uacb0", url: "#_44" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../js/google_analytics.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="https://www.googletagmanager.com/gtag/js?id=G-3F4LHCTF88"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1405/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1405/" class="btn btn-xs btn-link">
        빌드 최적화 방법
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1403/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1403/" class="btn btn-xs btn-link">
        교차 컴파일 환경 설정
      </a>
    </div>
    
  </div>

    

    <p>ROS2 환경에서의 빌드 및 실행 오류는 다양한 원인에 의해 발생할 수 있다. 빌드 시스템은 ROS2 패키지의 구조, 의존성 관리, colcon 빌드 도구의 설정, 그리고 코드의 작성 방식에 큰 영향을 받는다. 이 섹션에서는 일반적인 빌드 및 실행 오류와 그 해결 방법에 대해 자세히 설명한다.</p>
<h3 id="_1">종속성 관련 오류</h3>
<p>ROS2 패키지는 <code>package.xml</code>과 <code>CMakeLists.txt</code> 파일을 통해 종속성을 관리한다. 종종 빌드 시 다른 패키지나 라이브러리의 종속성을 찾지 못해 오류가 발생할 수 있다.</p>
<h4 id="_2">패키지 종속성 해결 방법</h4>
<p><code>package.xml</code> 파일에서 필요한 종속성(dependency)을 정의하지 않았거나, <code>CMakeLists.txt</code>에서 해당 라이브러리를 링크하지 않은 경우, 빌드 과정에서 종속성을 찾지 못해 오류가 발생한다.</p>
<pre><code class="language-xml">&lt;depend&gt;rclcpp&lt;/depend&gt;
&lt;depend&gt;std_msgs&lt;/depend&gt;
</code></pre>
<p>위와 같은 종속성 선언을 <code>package.xml</code>에 추가해야 한다. 또한, <code>CMakeLists.txt</code>에서 종속 라이브러리를 링크해야 한다.</p>
<pre><code class="language-cmake">find_package(rclcpp REQUIRED)
find_package(std_msgs REQUIRED)
</code></pre>
<p>이런 방식으로 필요한 패키지를 검색한 후 링크할 수 있다.</p>
<h4 id="colcon">colcon 빌드 도구 설정</h4>
<p><code>colcon build</code> 명령어는 ROS2에서 패키지를 빌드하는 기본 도구이다. 하지만 빌드가 실패할 경우, <code>colcon</code> 명령어에 여러 가지 옵션을 추가해 문제를 진단할 수 있다.</p>
<pre><code class="language-bash">colcon build --event-handlers console_cohesion+
</code></pre>
<p>이 명령어는 빌드 중 발생한 세부적인 정보를 터미널에 출력하여, 종속성이나 빌드 과정에서 발생한 문제를 쉽게 파악할 수 있게 도와준다.</p>
<h3 id="cmakeliststxt">CMakeLists.txt 설정 오류</h3>
<p><code>CMakeLists.txt</code> 파일에서 필요한 라이브러리나 헤더 파일을 찾지 못하는 경우에도 빌드 오류가 발생할 수 있다. 예를 들어, <code>find_package</code> 명령을 잘못 설정하거나, <code>target_link_libraries</code>에 필요한 라이브러리를 누락하면 아래와 같은 오류가 발생한다.</p>
<h4 id="cmakeliststxt_1">CMakeLists.txt 설정 예제</h4>
<pre><code class="language-cmake">find_package(rclcpp REQUIRED)
add_executable(my_node src/my_node.cpp)
ament_target_dependencies(my_node rclcpp std_msgs)
</code></pre>
<p>이와 같은 방식으로 올바른 패키지를 찾고, <code>ament_target_dependencies</code>를 사용하여 종속성을 명시해야 한다.</p>
<h4 id="cmake">CMake 변수 설정 오류</h4>
<p>CMake에서 변수의 설정이 잘못된 경우에도 빌드 오류가 발생할 수 있다. 이 경우, 변수들이 제대로 설정되었는지 확인하고, 누락된 변수가 있는지 확인해야 한다.</p>
<pre><code class="language-cmake">set(CMAKE_CXX_STANDARD 17)
</code></pre>
<p>위와 같은 구문을 통해 C++17 표준을 사용하는 경우, 이를 명시적으로 설정하지 않으면 빌드 오류가 발생할 수 있다.</p>
<h3 id="_3">런타임 오류</h3>
<p>런타임 오류는 노드 실행 중에 발생하는 오류로, 주로 종속성 문제나 메시지 형식의 불일치, 네임스페이스 설정 문제 등에서 발생할 수 있다.</p>
<h4 id="_4">메시지 형식 불일치</h4>
<p>ROS2에서 메시지를 주고받을 때, 퍼블리셔와 서브스크라이버가 사용하는 메시지 형식이 일치하지 않으면 실행 중에 오류가 발생한다. 이 문제를 해결하기 위해서는 퍼블리셔와 서브스크라이버가 동일한 메시지 타입을 사용하는지 확인해야 한다.</p>
<pre><code class="language-cpp">publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;(&quot;topic_name&quot;, 10);
</code></pre>
<p>위와 같이 퍼블리셔에서 사용한 메시지 타입이 서브스크라이버에서도 일치하는지 확인해야 한다.</p>
<pre><code class="language-cpp">subscription_ = this-&gt;create_subscription&lt;std_msgs::msg::String&gt;(
  &quot;topic_name&quot;, 10, std::bind(&amp;MyNode::callback, this, _1));
</code></pre>
<p>서브스크라이버의 메시지 타입이 <code>std_msgs::msg::String</code>과 동일한지 확인하여 형식 불일치를 방지할 수 있다.</p>
<h3 id="_5">실행 파일 권한 오류</h3>
<p>Linux 환경에서 ROS2 노드를 실행할 때 실행 권한이 없는 경우, "Permission denied" 오류가 발생할 수 있다. 이 경우, 실행 파일에 실행 권한을 부여해야 한다.</p>
<pre><code class="language-bash">chmod +x &lt;파일명&gt;
</code></pre>
<p>위 명령어를 통해 파일에 실행 권한을 부여한 후 다시 실행할 수 있다.</p>
<h3 id="_6">라이브러리 경로 설정 오류</h3>
<p>빌드 시 또는 실행 시 종종 라이브러리 경로 설정이 잘못되어 오류가 발생할 수 있다. 특히, 시스템에서 설치된 라이브러리나 외부 종속성 라이브러리 경로가 올바르게 설정되지 않으면, 빌드 과정에서 해당 라이브러리를 찾지 못하거나 실행 시 동적 라이브러리를 로드하지 못해 오류가 발생할 수 있다.</p>
<h4 id="ld_library_path"><code>LD_LIBRARY_PATH</code> 환경 변수 설정</h4>
<p>동적 라이브러리를 사용하는 경우, 해당 라이브러리의 경로를 <code>LD_LIBRARY_PATH</code>에 포함시켜야 한다. 이를 통해 실행 중에 동적 라이브러리를 찾을 수 있다.</p>
<pre><code class="language-bash">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/path/to/your/library
</code></pre>
<p>위 명령을 사용하여 라이브러리 경로를 추가하고, 올바르게 설정되었는지 확인한다.</p>
<h4 id="_7">라이브러리 경로 지정 오류</h4>
<p><code>CMakeLists.txt</code>에서 외부 라이브러리를 사용할 때, 라이브러리 경로를 명시적으로 지정해주어야 하는 경우가 있다. 경로를 잘못 지정하면 라이브러리를 찾지 못해 빌드가 실패할 수 있다.</p>
<pre><code class="language-cmake">link_directories(/path/to/your/library)
</code></pre>
<p>위와 같은 방식으로 CMake에서 라이브러리 경로를 설정할 수 있으며, 이를 통해 빌드 오류를 해결할 수 있다.</p>
<h3 id="ros2">ROS2 런치 파일 관련 오류</h3>
<p>ROS2에서는 노드 실행을 자동화하거나 여러 노드를 동시에 실행할 때 <code>launch</code> 파일을 사용한다. <code>launch</code> 파일에서 설정된 노드나 파라미터가 올바르지 않으면 실행 중에 오류가 발생할 수 있다.</p>
<h4 id="_8">런치 파일 오류 확인 방법</h4>
<p>런치 파일에서 설정된 파라미터나 경로가 잘못된 경우, 노드 실행이 실패할 수 있다. 이를 확인하기 위해서는 런치 파일의 구문을 꼼꼼히 확인하고, 필요할 경우 <code>ros2 launch</code> 명령어에서 추가적인 디버깅 옵션을 사용하여 문제를 진단할 수 있다.</p>
<pre><code class="language-bash">ros2 launch my_package my_launch_file.py --show-arguments
</code></pre>
<p>이 명령어는 런치 파일에서 설정된 인자들을 모두 출력하여 확인할 수 있다.</p>
<h3 id="_9">패키지 빌드 순서 문제</h3>
<p>여러 ROS2 패키지를 동시에 빌드할 때, 패키지 간 종속성이 올바르게 관리되지 않으면 빌드 순서 오류가 발생할 수 있다. 종속성 관계에 있는 패키지가 먼저 빌드되지 않으면 후속 패키지가 실패할 수 있다.</p>
<h4 id="_10">빌드 순서 해결 방법</h4>
<p><code>package.xml</code>에서 <code>build_depend</code> 태그와 <code>exec_depend</code> 태그를 올바르게 설정하면 빌드 순서를 지정할 수 있다.</p>
<pre><code class="language-xml">&lt;build_depend&gt;my_dependency_package&lt;/build_depend&gt;
</code></pre>
<p>이 태그를 통해 종속성 패키지를 먼저 빌드하도록 설정할 수 있으며, 이를 통해 빌드 순서 문제를 해결할 수 있다.</p>
<h3 id="ros2_1">ROS2 네임스페이스 및 리매핑 오류</h3>
<p>네임스페이스나 리매핑 설정에서 문제가 발생하면 노드 간 통신이 이루어지지 않아 실행 오류가 발생할 수 있다. 특히, 노드가 퍼블리시하는 토픽과 서브스크라이버가 구독하는 토픽이 다른 네임스페이스에 있으면 통신이 되지 않을 수 있다.</p>
<h4 id="_11">네임스페이스 설정 오류 해결</h4>
<p>네임스페이스를 사용할 때는 퍼블리셔와 서브스크라이버가 동일한 네임스페이스에서 통신하고 있는지 확인해야 한다.</p>
<pre><code class="language-bash">ros2 run my_package my_node --ros-args --remap __ns:=/my_namespace
</code></pre>
<p>위 명령을 통해 네임스페이스를 명시적으로 설정할 수 있으며, 네임스페이스가 올바르게 구성되었는지 확인할 수 있다.</p>
<h3 id="ros2_2">ROS2 메시지 빌드 오류</h3>
<p>메시지 타입 정의에서 발생하는 빌드 오류는 ROS2 환경에서 자주 발생하는 문제 중 하나이다. 사용자 정의 메시지 파일이 올바르게 정의되지 않았거나, 메시지 파일이 빌드 도구에 의해 인식되지 않는 경우 빌드 오류가 발생할 수 있다.</p>
<h4 id="_12">메시지 파일 정의 오류</h4>
<p>메시지 파일(<code>.msg</code>)을 정의할 때, 자료형이나 형식이 올바르지 않으면 빌드 오류가 발생할 수 있다. 예를 들어, 아래와 같은 메시지 파일을 정의한다고 가정한다.</p>
<pre><code class="language-plaintext">float32 position
float32 velocity
</code></pre>
<p>자료형과 변수명이 올바르게 정의되어야 하며, 자료형이 지원되는 형식인지 확인해야 한다. 정의한 메시지가 문제없이 빌드되려면 <code>package.xml</code>과 <code>CMakeLists.txt</code>에도 관련 설정을 추가해야 한다.</p>
<h4 id="_13">메시지 빌드 설정</h4>
<p><code>package.xml</code>에서 메시지 종속성을 명시적으로 선언해야 한다.</p>
<pre><code class="language-xml">&lt;build_depend&gt;rosidl_default_generators&lt;/build_depend&gt;
&lt;exec_depend&gt;rosidl_default_runtime&lt;/exec_depend&gt;
</code></pre>
<p>그리고 <code>CMakeLists.txt</code> 파일에서 메시지를 빌드하기 위해 아래와 같이 설정한다.</p>
<pre><code class="language-cmake">find_package(rosidl_default_generators REQUIRED)

rosidl_generate_interfaces(${PROJECT_NAME}
  &quot;msg/MyCustomMessage.msg&quot;
)
</code></pre>
<p>이후 <code>colcon build</code>를 통해 메시지를 포함한 패키지를 빌드할 수 있다. 만약 메시지 빌드 오류가 발생하면, 메시지 파일의 형식과 <code>CMakeLists.txt</code> 및 <code>package.xml</code>의 설정을 다시 확인해야 한다.</p>
<h3 id="qos">QoS 설정 오류</h3>
<p>ROS2에서는 네트워크 통신 시 품질 서비스(QoS) 설정이 매우 중요하다. QoS 설정이 올바르지 않으면 메시지가 적절히 전송되지 않거나, 메시지 손실이 발생할 수 있다.</p>
<h4 id="qos_1">QoS 설정</h4>
<p>QoS는 퍼블리셔와 서브스크라이버 간의 통신 품질을 정의한다. 기본적으로 <code>rclcpp::QoS</code> 객체를 통해 QoS 설정을 관리할 수 있다. 만약 퍼블리셔와 서브스크라이버의 QoS 설정이 맞지 않으면 통신 오류가 발생할 수 있다.</p>
<pre><code class="language-cpp">rclcpp::QoS qos_settings = rclcpp::QoS(10).reliable().transient_local();
publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;(&quot;topic_name&quot;, qos_settings);
</code></pre>
<p>퍼블리셔와 서브스크라이버의 QoS 설정을 맞추어 통신이 원활히 이루어지는지 확인하는 것이 중요하다.</p>
<h3 id="_14">환경 변수 설정 오류</h3>
<p>ROS2 시스템에서 잘못된 환경 변수 설정은 빌드 및 실행 오류를 일으킬 수 있다. 예를 들어, <code>ROS_DOMAIN_ID</code>, <code>AMENT_PREFIX_PATH</code>, <code>COLCON_PREFIX_PATH</code> 등의 환경 변수가 올바르게 설정되지 않으면 빌드 및 실행이 실패할 수 있다.</p>
<h4 id="_15">환경 변수 설정 방법</h4>
<p><code>ROS_DOMAIN_ID</code>는 여러 노드가 동일 네트워크 상에서 통신할 때 충돌을 방지하기 위해 사용된다. 이 값이 서로 다른 네트워크에서 실행되는 노드와 일치하지 않으면 통신 오류가 발생할 수 있다.</p>
<pre><code class="language-bash">export ROS_DOMAIN_ID=0
</code></pre>
<p>이외에도 <code>AMENT_PREFIX_PATH</code>와 <code>COLCON_PREFIX_PATH</code>가 패키지 빌드 후에도 올바르게 설정되어야 한다. 다음 명령을 통해 경로를 설정할 수 있다.</p>
<pre><code class="language-bash">source /opt/ros/humble/setup.bash
</code></pre>
<p>이 명령을 통해 ROS2 설치 경로에 있는 모든 패키지를 인식하고 사용할 수 있다.</p>
<h3 id="_16">노드 종료 후 재시작 오류</h3>
<p>ROS2 노드를 종료한 후에 재시작할 때 발생하는 오류는 흔히 시스템 자원이 제대로 해제되지 않거나 포트가 여전히 점유된 상태에서 발생한다. 노드가 정상적으로 종료되지 않으면 시스템 리소스가 해제되지 않아 재시작 시 충돌이 발생할 수 있다.</p>
<h4 id="_17">포트 충돌 해결</h4>
<p>ROS2 노드가 특정 포트를 사용하고 있는 경우, 해당 포트가 점유된 상태에서 다시 시작하려면 충돌이 발생한다. 이런 경우, 해당 포트를 수동으로 해제하거나 일정 시간 대기한 후 노드를 재시작할 수 있다.</p>
<pre><code class="language-bash">sudo lsof -i -P -n | grep LISTEN
</code></pre>
<p>위 명령을 통해 현재 사용 중인 포트를 확인한 후, 충돌을 일으키는 포트를 해제하고 노드를 다시 실행할 수 있다.</p>
<h3 id="_18">실시간 시스템에서의 빌드 및 실행 오류</h3>
<p>실시간 시스템에서 ROS2를 사용할 경우, 일반적인 시스템과 다른 오류가 발생할 수 있다. 특히, 노드의 우선 순위와 스케줄링 정책이 잘못 설정되면 실시간 성능이 저하되거나, 빌드 및 실행 중 오류가 발생할 수 있다.</p>
<h4 id="_19">스케줄링 정책 설정</h4>
<p>실시간 시스템에서는 노드의 우선 순위 및 스케줄링 정책을 설정하여 자원 할당을 관리한다. 실시간 시스템에서 사용하는 스케줄링 정책은 일반적으로 <code>SCHED_FIFO</code> 또는 <code>SCHED_RR</code>이다.</p>
<pre><code class="language-cpp">sched_param sch_params;
sch_params.sched_priority = 50;
if (sched_setscheduler(0, SCHED_FIFO, &amp;sch_params)) {
  perror(&quot;sched_setscheduler failed&quot;);
}
</code></pre>
<p>실시간 시스템에서 노드의 우선 순위를 적절히 설정하고, 스케줄링 정책을 적용해야만 안정적인 실행이 가능한다.</p>
<h3 id="_20">빌드 캐시 문제</h3>
<p>빌드 도중 캐시가 잘못되거나 손상된 경우에도 빌드 및 실행 오류가 발생할 수 있다. 특히 <code>colcon</code> 빌드 시스템에서, 이전 빌드의 캐시가 제대로 삭제되지 않거나 갱신되지 않으면 빌드 중 이상한 오류가 발생할 수 있다.</p>
<h4 id="_21">빌드 캐시 삭제</h4>
<p>이 문제를 해결하기 위해서는 빌드 캐시를 삭제하고, 깨끗한 상태에서 다시 빌드하는 방법을 사용할 수 있다.</p>
<pre><code class="language-bash">colcon build --clean
</code></pre>
<p>또는 <code>build</code>와 <code>install</code>, <code>log</code> 디렉토리를 수동으로 삭제한 후 다시 빌드할 수도 있다.</p>
<pre><code class="language-bash">rm -rf build/ install/ log/
colcon build
</code></pre>
<p>이 명령어를 사용하면 이전 빌드의 잔여물을 완전히 제거하고, 새로운 상태에서 빌드를 수행할 수 있다.</p>
<h3 id="_22">노드 상호 종속성 문제</h3>
<p>여러 노드 간의 상호 종속성이 있을 때, 노드 간의 의존성 문제가 발생할 수 있다. 예를 들어, 하나의 노드가 다른 노드의 실행에 의존하는 경우, 해당 노드가 먼저 실행되지 않으면 통신 오류가 발생할 수 있다.</p>
<h4 id="_23">런치 파일에서의 노드 의존성 설정</h4>
<p>런치 파일을 사용할 때, 노드 간의 종속성을 명시적으로 설정하여 이러한 문제를 해결할 수 있다. 예를 들어, 한 노드가 다른 노드의 실행이 완료된 후 실행되도록 설정하려면, <code>launch.actions.ExecuteProcess</code>의 <code>on_exit</code> 옵션을 사용할 수 있다.</p>
<pre><code class="language-python">from launch import LaunchDescription
from launch.actions import ExecuteProcess

def generate_launch_description():
    return LaunchDescription([
        ExecuteProcess(
            cmd=['ros2', 'run', 'my_package', 'my_first_node'],
            output='screen'
        ),
        ExecuteProcess(
            cmd=['ros2', 'run', 'my_package', 'my_second_node'],
            output='screen',
            on_exit=[ExecuteProcess(
                cmd=['ros2', 'run', 'my_package', 'my_third_node'],
                output='screen'
            )]
        )
    ])
</code></pre>
<p>이와 같이 <code>on_exit</code>를 사용하여 첫 번째 노드 실행이 종료된 후에 두 번째 노드가 실행되도록 의존성을 설정할 수 있다.</p>
<h3 id="ros2_3">ROS2 파라미터 설정 오류</h3>
<p>노드가 실행 중에 ROS2 파라미터 서버와 통신하여 다양한 설정을 관리하는데, 이때 잘못된 파라미터 설정은 빌드나 실행 오류를 유발할 수 있다. 특히 파라미터의 타입이나 범위가 올바르지 않은 경우 문제가 발생할 수 있다.</p>
<h4 id="_24">파라미터 타입 및 범위 확인</h4>
<p>파라미터가 잘못 설정되면 노드 실행 중에 오류가 발생할 수 있다. 예를 들어, 노드에서 정수형 파라미터가 필요하지만 실수형 값이 전달된 경우, 이를 파악하고 수정해야 한다.</p>
<pre><code class="language-bash">ros2 param set /my_node my_param 10
</code></pre>
<p>파라미터 설정을 변경할 때, 파라미터의 타입과 범위가 정확한지 확인하고 설정해야 한다. 이를 위해 파라미터의 기본값이나 허용 범위를 <code>declare_parameter</code> 함수로 명시할 수 있다.</p>
<pre><code class="language-cpp">this-&gt;declare_parameter&lt;int&gt;(&quot;my_param&quot;, 0);
</code></pre>
<p>위와 같이 파라미터의 기본값과 타입을 명시하면, 잘못된 값이 설정되는 것을 방지할 수 있다.</p>
<h3 id="_25">실시간 노드 우선 순위 및 자원 할당 문제</h3>
<p>실시간 시스템에서 ROS2 노드의 우선 순위가 잘못 설정되면 자원 할당에 문제가 생기고, 실행 중 오류가 발생할 수 있다. 특히 노드 간의 자원 경쟁이나 CPU 스케줄링 문제로 인해 실시간 성능이 저하될 수 있다.</p>
<h4 id="_26">우선 순위 및 스케줄링 정책 설정</h4>
<p>노드의 실시간 성능을 보장하려면, ROS2 노드에 적절한 우선 순위를 설정하고, 실시간 스케줄링 정책을 적용해야 한다.</p>
<pre><code class="language-cpp">#include &lt;pthread.h&gt;

pthread_t this_thread = pthread_self();
sched_param sch_params;
sch_params.sched_priority = 90;
pthread_setschedparam(this_thread, SCHED_FIFO, &amp;sch_params);
</code></pre>
<p>이 코드를 통해 실시간 스케줄링 정책을 적용하고, 우선 순위를 설정할 수 있다. 우선 순위가 낮으면 자원이 충분히 할당되지 않아 성능이 저하될 수 있으므로 적절한 값을 설정해야 한다.</p>
<h3 id="_27">콜백 지연 및 처리 성능 문제</h3>
<p>ROS2 노드에서 여러 콜백 함수가 동시에 실행될 때, 콜백 지연이나 처리 성능 저하가 발생할 수 있다. 이는 주로 콜백 함수가 너무 오래 걸리거나, 여러 콜백이 한 번에 실행되어 자원 경쟁이 발생할 때 발생한다.</p>
<h4 id="_28">멀티스레딩을 통한 콜백 처리 최적화</h4>
<p>ROS2에서는 <code>Multi-threaded Executor</code>를 사용하여 여러 콜백을 병렬로 처리할 수 있다. 이를 통해 콜백 함수가 동시에 여러 개 실행될 때 성능 저하를 방지할 수 있다.</p>
<pre><code class="language-cpp">rclcpp::executors::MultiThreadedExecutor executor;
auto node = std::make_shared&lt;MyNode&gt;();
executor.add_node(node);
executor.spin();
</code></pre>
<p>위 코드는 여러 콜백을 동시에 처리하기 위해 멀티스레딩 실행자를 사용하는 예제이다. 이렇게 설정하면 여러 콜백 함수가 병렬로 실행되어 자원 사용 효율이 개선된다.</p>
<h4 id="_29">콜백 지연 원인 분석</h4>
<p>콜백 함수가 지연되는 주된 원인은 비동기 처리 또는 다른 콜백과의 자원 충돌이다. 이런 경우, 콜백 함수의 처리 시간을 줄이거나, 별도의 스레드에서 비동기 작업을 처리하는 방식으로 문제를 해결할 수 있다.</p>
<pre><code class="language-cpp">void MyNode::timer_callback()
{
  // 무거운 작업을 백그라운드 스레드로 실행
  std::async(std::launch::async, [this]() {
    this-&gt;heavy_computation();
  });
}
</code></pre>
<p>위 코드처럼 콜백 함수 내부에서 비동기 처리를 수행하면 콜백 지연 문제를 완화할 수 있다.</p>
<h3 id="_30">시스템 메모리 누수 문제</h3>
<p>ROS2 노드를 장시간 실행할 경우, 메모리 누수가 발생하여 시스템 자원을 모두 소모하고 결국 실행 오류가 발생할 수 있다. 메모리 누수는 주로 동적 메모리 할당과 해제가 적절히 관리되지 않을 때 발생한다.</p>
<h4 id="_31">메모리 관리 및 누수 방지</h4>
<p>C++ 노드에서 메모리 누수를 방지하려면, 동적 메모리 할당을 최소화하고, 스마트 포인터를 사용하여 자동으로 메모리를 해제하는 것이 좋다.</p>
<pre><code class="language-cpp">std::shared_ptr&lt;MyClass&gt; obj = std::make_shared&lt;MyClass&gt;();
</code></pre>
<p>위와 같이 <code>std::shared_ptr</code> 또는 <code>std::unique_ptr</code>을 사용하면 객체의 수명이 끝날 때 자동으로 메모리가 해제된다. 이를 통해 수동으로 메모리를 해제하는 번거로움을 줄이고 메모리 누수를 방지할 수 있다.</p>
<h4 id="_32">메모리 사용량 모니터링</h4>
<p>메모리 누수를 발견하기 위해 시스템의 메모리 사용량을 모니터링하는 것이 중요하다. Linux 환경에서는 <code>top</code> 명령어를 사용하여 메모리 사용량을 실시간으로 확인할 수 있다.</p>
<pre><code class="language-bash">top -p &lt;노드 PID&gt;
</code></pre>
<p>또한, <code>valgrind</code>와 같은 메모리 디버깅 도구를 사용하여 메모리 누수를 검사할 수 있다.</p>
<pre><code class="language-bash">valgrind --leak-check=full ./my_ros2_node
</code></pre>
<p>이 명령어를 통해 메모리 누수의 원인을 정확히 파악하고 해결할 수 있다.</p>
<h3 id="_33">네트워크 연결 및 통신 문제</h3>
<p>ROS2는 DDS 기반의 분산 시스템에서 동작하며, 네트워크 문제로 인해 통신 오류가 발생할 수 있다. 특히, 네트워크 지연(latency)이나 패킷 손실이 발생하면 노드 간 통신에 문제가 생길 수 있다.</p>
<h4 id="_34">네트워크 트래픽 제어 및 최적화</h4>
<p>ROS2에서는 네트워크 트래픽을 최적화하기 위해 DDS의 QoS 설정을 적절히 사용하는 것이 중요하다. <code>reliability</code>, <code>durability</code>, <code>history</code>, <code>deadline</code>과 같은 QoS 정책을 통해 네트워크 통신 성능을 최적화할 수 있다.</p>
<pre><code class="language-cpp">rclcpp::QoS qos_settings = rclcpp::QoS(10)
  .reliable()
  .history(rclcpp::HistoryPolicy::KeepLast);
</code></pre>
<p><code>reliable()</code>은 메시지 전달을 보장하는 QoS 정책으로, 통신이 끊기거나 패킷이 손실되는 경우 자동으로 재전송을 시도한다. 또한 <code>history()</code>를 사용하여 최근 N개의 메시지만 저장하도록 설정할 수 있다.</p>
<h4 id="_35">네트워크 지연 및 패킷 손실 해결</h4>
<p>네트워크 지연이나 패킷 손실 문제가 발생할 경우, DDS의 QoS 설정을 수정하거나 네트워크 환경을 점검해야 한다. 네트워크 상태를 점검하려면 <code>ping</code>, <code>traceroute</code> 같은 네트워크 진단 도구를 사용할 수 있다.</p>
<pre><code class="language-bash">ping &lt;네트워크 주소&gt;
</code></pre>
<p>이 명령어를 통해 네트워크 지연이 있는지 확인하고, 통신 경로의 문제를 파악할 수 있다.</p>
<h3 id="ros2_4">ROS2 실행 파일 링크 문제</h3>
<p>ROS2 노드 실행 시, 실행 파일이 라이브러리와 제대로 링크되지 않으면 실행 중에 오류가 발생할 수 있다. 이 문제는 특히 외부 라이브러리나 ROS2의 특정 패키지에 의존할 때 발생하는 경우가 많다.</p>
<h4 id="cmakeliststxt_2"><code>CMakeLists.txt</code>의 링크 문제 해결</h4>
<p><code>CMakeLists.txt</code> 파일에서 적절히 라이브러리를 링크하지 않으면 런타임에 필요한 라이브러리를 찾지 못해 오류가 발생할 수 있다. 이를 해결하기 위해 <code>target_link_libraries()</code>를 올바르게 설정해야 한다.</p>
<pre><code class="language-cmake">target_link_libraries(my_node
  ${rclcpp_LIBRARIES}
  ${std_msgs_LIBRARIES}
)
</code></pre>
<p>또한, 외부 라이브러리를 사용할 때는 해당 라이브러리의 경로를 명시해야 하며, 패키지 종속성을 정확히 관리해야 한다.</p>
<pre><code class="language-cmake">find_package(rclcpp REQUIRED)
find_package(std_msgs REQUIRED)
find_package(your_external_library REQUIRED)

target_link_libraries(my_node your_external_library)
</code></pre>
<p>이와 같이 필요한 라이브러리를 명시적으로 링크하여 빌드 및 실행 오류를 방지할 수 있다.</p>
<h4 id="_36">동적 라이브러리 문제</h4>
<p>동적 라이브러리(<code>.so</code> 파일)의 경로를 찾지 못하는 경우, 시스템에서 <code>LD_LIBRARY_PATH</code> 환경 변수를 설정해야 한다. 동적 라이브러리 경로가 제대로 설정되지 않으면 런타임에 실행 파일이 해당 라이브러리를 찾지 못해 오류가 발생한다.</p>
<pre><code class="language-bash">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/path/to/your/library
</code></pre>
<p>위 명령어를 통해 동적 라이브러리 경로를 시스템에 추가한 후, 노드를 다시 실행할 수 있다.</p>
<h3 id="_37">실행 파일 경로 설정 문제</h3>
<p>ROS2 노드를 실행할 때, 빌드된 실행 파일의 경로가 잘못 설정되면 <code>command not found</code>와 같은 오류가 발생할 수 있다. 이는 ROS2 워크스페이스 설정이 올바르지 않거나, 빌드된 파일을 찾지 못하는 경우에 발생한다.</p>
<h4 id="_38">실행 파일 경로 설정</h4>
<p>빌드된 실행 파일의 경로를 확인하려면, ROS2 워크스페이스를 올바르게 설정해야 한다. <code>source</code> 명령을 통해 워크스페이스를 활성화하고, 설치된 패키지나 실행 파일을 찾을 수 있도록 경로를 설정해야 한다.</p>
<pre><code class="language-bash">source /path/to/your/ros2_ws/install/setup.bash
</code></pre>
<p>위 명령어를 실행하여 워크스페이스 설정을 활성화한 후, ROS2 명령어를 통해 노드를 실행할 수 있다.</p>
<h4 id="_39">실행 파일 위치 확인</h4>
<p><code>colcon build</code>가 완료된 후 빌드된 실행 파일의 위치를 확인하려면 다음과 같은 명령어를 사용할 수 있다.</p>
<pre><code class="language-bash">find install/ -name my_node
</code></pre>
<p>이 명령어를 통해 빌드된 실행 파일의 위치를 찾아 실행할 수 있다.</p>
<h3 id="_40">노드 간 통신 불가 문제</h3>
<p>ROS2 시스템에서 퍼블리셔와 서브스크라이버 간의 통신이 이루어지지 않는 경우, 네트워크 설정, QoS 설정, 또는 토픽 이름 불일치와 같은 문제가 있을 수 있다. 이러한 문제는 주로 통신 채널 설정 오류로 인해 발생한다.</p>
<h4 id="_41">토픽 이름 불일치</h4>
<p>퍼블리셔와 서브스크라이버가 동일한 토픽을 사용하고 있는지 확인하는 것이 중요하다. 토픽 이름이 다르면 노드 간에 통신이 이루어지지 않는다.</p>
<pre><code class="language-bash">ros2 topic list
</code></pre>
<p>위 명령어를 통해 현재 활성화된 모든 토픽을 나열하여, 퍼블리셔와 서브스크라이버가 동일한 토픽을 사용하고 있는지 확인할 수 있다.</p>
<h4 id="qos_2">QoS 정책 불일치</h4>
<p>퍼블리셔와 서브스크라이버의 QoS 설정이 불일치하면 메시지가 제대로 전달되지 않을 수 있다. 특히 <code>reliability</code>, <code>durability</code> 등의 설정이 다를 경우 통신 오류가 발생할 수 있다.</p>
<pre><code class="language-cpp">rclcpp::QoS qos_settings = rclcpp::QoS(10).best_effort();
publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;(&quot;topic_name&quot;, qos_settings);
</code></pre>
<p>퍼블리셔와 서브스크라이버 모두 동일한 QoS 설정을 사용하고 있는지 확인하고, QoS 정책을 일치시키면 통신 오류를 해결할 수 있다.</p>
<h3 id="_42">런타임 충돌 문제</h3>
<p>ROS2 노드가 실행 중에 충돌하거나 예기치 않게 종료되는 경우, 메모리 관리, 스레드 처리, 또는 라이브러리 호환성 문제에서 발생할 수 있다. 특히, 잘못된 메모리 접근이나 동시성 문제가 있을 때 충돌이 발생할 가능성이 높다.</p>
<h4 id="_43">메모리 접근 오류</h4>
<p>C++에서 동적 메모리 접근을 잘못 관리하거나, 할당되지 않은 메모리에 접근하면 런타임 충돌이 발생할 수 있다. 이 문제를 해결하기 위해서는 메모리 접근 방식을 꼼꼼히 검토하고, 메모리 해제 여부를 확인해야 한다.</p>
<pre><code class="language-cpp">std::shared_ptr&lt;MyClass&gt; obj = std::make_shared&lt;MyClass&gt;();
</code></pre>
<p>스마트 포인터를 사용하여 메모리 관리 문제를 방지할 수 있으며, 포인터가 해제되기 전에 접근하는 경우를 방지할 수 있다.</p>
<h4 id="_44">동시성 문제 해결</h4>
<p>멀티스레딩 환경에서의 동시성 문제는 충돌의 주요 원인이 될 수 있다. 특히, 하나의 자원에 여러 스레드가 동시에 접근할 때 충돌이 발생할 수 있으므로, 이를 해결하기 위해서는 <code>mutex</code>와 같은 동기화 도구를 사용하여 자원 접근을 제어해야 한다.</p>
<pre><code class="language-cpp">std::mutex mtx;
std::lock_guard&lt;std::mutex&gt; lock(mtx);
// 임계 구역
</code></pre>
<p>위 코드처럼 <code>std::mutex</code>와 <code>std::lock_guard</code>를 사용하여 자원에 대한 접근을 동기화하면 동시성 문제로 인한 충돌을 방지할 수 있다.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1405/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1405/" class="btn btn-xs btn-link">
        빌드 최적화 방법
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1403/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1403/" class="btn btn-xs btn-link">
        교차 컴파일 환경 설정
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>