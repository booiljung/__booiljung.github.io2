<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://booiljung.github.io/robot/ros2%20humble/chapter%2011/1103/" rel="canonical"/>
<link href="../../../../img/favicon.ico" rel="shortcut icon"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<title>동적 파라미터 설정 및 재구성 - 실험 도서관</title>
<link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet"/>
<link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet"/>
<link href="../../../../css/base.css" rel="stylesheet"/>
<link href="../../../../css/highlight.css" rel="stylesheet"/>
<link href="../../../../css/custom.css" rel="stylesheet"/>
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<script src="../../../../js/jquery-3.2.1.min.js"></script>
<script src="../../../../js/bootstrap-3.3.7.min.js"></script>
<script src="../../../../js/highlight.pack.js"></script>
<base target="_top"/>
<script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uac1c\uc694", url: "#_top", children: [
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \uc120\uc5b8\uacfc \uae30\ubcf8 \uac12 \uc124\uc815", url: "#_2", children: [
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \uc7ac\uad6c\uc131", url: "#_3", children: [
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \uc11c\ubc84 \ub3d9\uc791 \uc6d0\ub9ac", url: "#_4", children: [
          ]},
          {title: "\uc218\ud559\uc801 \ubaa8\ub378", url: "#_5", children: [
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \uc5c5\ub370\uc774\ud2b8\uc758 \uc2e4\uc2dc\uac04 \ucc98\ub9ac", url: "#_6", children: [
          ]},
          {title: "\ub3d9\uc801 \ud30c\ub77c\ubbf8\ud130 \uc124\uc815 \uc608\uc2dc", url: "#_7", children: [
          ]},
          {title: "\ub3d9\uc801 \ud30c\ub77c\ubbf8\ud130\uc758 \uc2e4\uc2dc\uac04 \uc7ac\uad6c\uc131", url: "#_8", children: [
              {title: "\ud30c\ub77c\ubbf8\ud130 \ucf5c\ubc31 \uad6c\uc870", url: "#_9" },
              {title: "\uc2e4\uc2dc\uac04 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\uc758 \uc801\uc6a9", url: "#_10" },
              {title: "\ud30c\ub77c\ubbf8\ud130 \ubcc0\uacbd\uc744 \ud1b5\ud55c \uc2dc\uc2a4\ud15c \ub3d9\uc791 \ubcc0\ud654", url: "#_11" },
          ]},
          {title: "\ub3d9\uc801 \ud30c\ub77c\ubbf8\ud130\uc758 \uc0ac\uc6a9 \uc0ac\ub840", url: "#_12", children: [
              {title: "\uada4\uc801 \ubcc0\uacbd\uc744 \uc704\ud55c \ud30c\ub77c\ubbf8\ud130\ud654\ub41c \uc0c1\ud0dc \uacf5\uac04 \ubaa8\ub378", url: "#_13" },
          ]},
          {title: "\ub3d9\uc801 \ud30c\ub77c\ubbf8\ud130\uc640 \uc0c1\ud0dc \ud53c\ub4dc\ubc31", url: "#_14", children: [
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \uc7ac\uc124\uc815\uacfc \uc7ac\uad6c\uc131\uc758 \uc2e4\uc2b5", url: "#_15", children: [
              {title: "\ud30c\ub77c\ubbf8\ud130 \uc11c\ubc84\uc5d0\uc11c\uc758 \ud30c\ub77c\ubbf8\ud130 \uc7ac\uad6c\uc131", url: "#_16" },
              {title: "\ud30c\ub77c\ubbf8\ud130 \uc124\uc815 \ud6c4 \ub3d9\uc791 \ud655\uc778", url: "#_17" },
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \ubcc0\uacbd\uc744 \ud1b5\ud55c \ub85c\ubd07 \ub3d9\uc791 \uc2e4\uc2b5", url: "#_18", children: [
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130\uc758 \ubc94\uc704 \uc81c\ud55c \ubc0f \uc608\uc678 \ucc98\ub9ac", url: "#_19", children: [
              {title: "\ubc94\uc704 \uc81c\ud55c \uc608\uc2dc", url: "#_20" },
          ]},
          {title: "\ud30c\ub77c\ubbf8\ud130 \ubcc0\uacbd\uc744 \ud1b5\ud55c \ub85c\ubd07 \uc81c\uc5b4\uc758 \uc218\ud559\uc801 \ubaa8\ub378\ub9c1", url: "#_21", children: [
          ]},
          {title: "\ub3d9\uc801 \ud30c\ub77c\ubbf8\ud130 \uc2dc\uc2a4\ud15c\uc758 QoS \uc124\uc815", url: "#qos", children: [
          ]},
        ];

    </script>
<script src="../../../../js/base.js"></script>
<script src="../../../../js/google_analytics.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-3F4LHCTF88"></script>
</meta></head>
<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>
<div class="container-fluid wm-page-content">
<a name="_top"></a>
<div aria-label="navigation" class="row wm-article-nav-buttons" role="navigation">
<div class="wm-article-nav pull-right">
<a class="btn btn-xs btn-default pull-right" href="../1104/">
        Next
        <i aria-hidden="true" class="fa fa-chevron-right"></i>
</a>
<a class="btn btn-xs btn-link" href="../1104/">
        파라미터 변경 이벤트 처리 방법
      </a>
</div>
<div class="wm-article-nav">
<a class="btn btn-xs btn-default pull-left" href="../1102/">
<i aria-hidden="true" class="fa fa-chevron-left"></i>
        Previous</a><a class="btn btn-xs btn-link" href="../1102/">
        다중 노드 간 파라미터 공유 방법
      </a>
</div>
</div>
<h3 id="_1">개요</h3>
<p>ROS2에서 파라미터는 노드의 동작을 제어하는 중요한 설정 요소이다. 동적 파라미터는 실행 중에 노드의 파라미터를 변경할 수 있게 하여 시스템의 유연성을 극대화한다. 동적 파라미터를 사용하는 방식은 ROS1에서와 비교해 많이 개선되었으며, ROS2에서는 별도의 노드 중단 없이 파라미터를 재구성할 수 있다.</p>
<h3 id="_2">파라미터 선언과 기본 값 설정</h3>
<p>노드가 시작될 때 필요한 파라미터를 선언하고 초기 값을 설정할 수 있다. 선언은 다음과 같은 방식으로 이루어진다.</p>
<pre><code class="language-cpp">this-&gt;declare_parameter("speed", 10.0);
this-&gt;declare_parameter("direction", "north");
</code></pre>
<p>위 코드는 노드가 시작될 때 <code>speed</code>라는 파라미터를 실수형으로 선언하고 기본값을 <code>10.0</code>으로 설정하며, <code>direction</code>이라는 문자열형 파라미터도 선언하여 기본값을 <code>"north"</code>로 설정한다.</p>
<h3 id="_3">파라미터 재구성</h3>
<p>동적 파라미터 재구성을 위해서는 먼저 파라미터가 변경될 때 콜백을 등록해야 한다. 이를 통해 파라미터 값이 변경되면 즉시 새로운 값이 노드에 반영되도록 한다. 파라미터 콜백은 다음과 같이 작성된다.</p>
<pre><code class="language-cpp">this-&gt;set_on_parameters_set_callback(
    [this](const std::vector&lt;rclcpp::Parameter&gt; &amp;parameters) {
        for (const auto &amp;param : parameters) {
            if (param.get_name() == "speed") {
                // 새로운 속도 값을 설정
                speed_ = param.as_double();
            }
        }
        return rcl_interfaces::msg::SetParametersResult{true};
    });
</code></pre>
<p>이 코드는 <code>speed</code> 파라미터가 변경되었을 때 새로운 값을 적용하는 콜백이다. 이 콜백은 노드가 실행 중일 때 설정한 파라미터의 값을 즉시 업데이트할 수 있다.</p>
<h3 id="_4">파라미터 서버 동작 원리</h3>
<p>파라미터 서버는 각 노드 내에서 파라미터를 관리하며, 노드는 클라이언트를 통해 파라미터 값을 동적으로 수정할 수 있다. 파라미터 서버는 노드가 선언한 파라미터의 값을 기록하고, 이 값에 접근하는 모든 요청에 응답한다.</p>
<p>다음은 파라미터 재구성의 주요 절차를 요약한 것이다.</p>
<div class="mermaid">graph TD;
    Start[노드 시작] --&gt; |파라미터 선언| Param[파라미터 서버에서 파라미터 값 설정]
    Param --&gt; |변경 요청| Reconfig[파라미터 콜백 등록]
    Reconfig --&gt; |파라미터 값 변경| Update[새로운 파라미터 값 반영]
</div>
<h3 id="_5">수학적 모델</h3>
<p>동적 파라미터의 활용을 시스템의 상태 공간 모델과 결합할 때, 이를 수식으로 표현하면 다음과 같다. 예를 들어, 파라미터 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{p}</span><script type="math/tex">\mathbf{p}</script></span>가 시스템의 상태에 영향을 미치는 경우:</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathbf{x}(t+1) = \mathbf{A} \mathbf{x}(t) + \mathbf{B} \mathbf{u}(t) + \mathbf{P} \mathbf{p}(t)
</div>
<script type="math/tex; mode=display">
\mathbf{x}(t+1) = \mathbf{A} \mathbf{x}(t) + \mathbf{B} \mathbf{u}(t) + \mathbf{P} \mathbf{p}(t)
</script>
</div>
<p>여기서:
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{x}(t)</span><script type="math/tex">\mathbf{x}(t)</script></span>는 시스템의 상태 벡터
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{A}</span><script type="math/tex">\mathbf{A}</script></span>는 상태 전이 행렬
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{B}</span><script type="math/tex">\mathbf{B}</script></span>는 입력 제어 행렬
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{u}(t)</span><script type="math/tex">\mathbf{u}(t)</script></span>는 입력 벡터
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{P}</span><script type="math/tex">\mathbf{P}</script></span>는 파라미터가 상태에 미치는 영향을 나타내는 행렬
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{p}(t)</span><script type="math/tex">\mathbf{p}(t)</script></span>는 동적으로 변화하는 파라미터 벡터</p>
<p>이 식은 파라미터가 시스템의 상태에 미치는 영향을 나타낸다. 동적 파라미터를 변경함으로써 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{p}(t)</span><script type="math/tex">\mathbf{p}(t)</script></span>가 달라지고, 이에 따라 시스템의 동작도 실시간으로 변경된다.</p>
<h3 id="_6">파라미터 업데이트의 실시간 처리</h3>
<p>파라미터를 동적으로 재구성할 때 중요한 점은 실시간 시스템에서의 처리 지연을 최소화하는 것이다. 파라미터 업데이트는 주기적으로 또는 이벤트 기반으로 발생할 수 있으며, 실시간으로 처리해야 하는 경우에는 시스템의 응답성이 매우 중요하다. 이를 위해 ROS2에서는 QoS(품질 서비스) 정책을 적절히 설정하여 노드 간의 통신 지연을 최소화한다.</p>
<p>파라미터 업데이트 과정에서의 중요한 QoS 설정 요소는 다음과 같다:
- 신뢰성(reliability): <code>Reliable</code> 또는 <code>Best Effort</code>
- 내구성(durability): <code>Transient Local</code> 또는 <code>Volatile</code></p>
<h3 id="_7">동적 파라미터 설정 예시</h3>
<p>다음은 <code>speed</code>라는 파라미터가 실시간으로 변경될 수 있는 시스템에서의 설정 예시이다. 이 경우 <code>speed</code> 파라미터가 차량의 속도를 제어한다고 가정할 수 있다.</p>
<pre><code class="language-cpp">rclcpp::Node::SharedPtr node = rclcpp::Node::make_shared("dynamic_parameter_node");

node-&gt;declare_parameter("speed", 0.0);

auto parameters_client = std::make_shared&lt;rclcpp::SyncParametersClient&gt;(node);

while (!parameters_client-&gt;wait_for_service(1s)) {
    RCLCPP_INFO(node-&gt;get_logger(), "Waiting for parameter service...");
}

parameters_client-&gt;set_parameters({rclcpp::Parameter("speed", 10.0)});
</code></pre>
<p>이 코드에서는 <code>speed</code> 파라미터가 초기화된 후, 클라이언트를 통해 동적으로 값을 변경하고 있다. 이처럼 ROS2에서는 파라미터 값을 간단히 클라이언트를 통해 설정할 수 있으며, 이러한 설정은 노드의 동작에 즉시 반영된다.</p>
<h3 id="_8">동적 파라미터의 실시간 재구성</h3>
<p>실시간으로 파라미터를 재구성하는 작업은 주로 노드가 실행 중일 때 이루어지며, 이를 위해 ROS2는 파라미터 콜백 메커니즘을 제공한다. 콜백을 사용하면 특정 파라미터가 변경되었을 때 이에 대한 반응을 즉시 처리할 수 있다. 이 과정은 실시간 시스템에서 매우 유용하며, 아래와 같은 단계를 통해 파라미터를 재구성한다.</p>
<h4 id="_9">파라미터 콜백 구조</h4>
<pre><code class="language-cpp">rcl_interfaces::msg::SetParametersResult parameter_callback(
    const std::vector&lt;rclcpp::Parameter&gt; &amp;parameters)
{
    rcl_interfaces::msg::SetParametersResult result;
    result.successful = true;

    for (const auto &amp;param : parameters) {
        if (param.get_name() == "speed") {
            if (param.as_double() &gt;= 0) {
                speed_ = param.as_double();
            } else {
                result.successful = false;
            }
        }
    }

    return result;
}
</code></pre>
<p>이 콜백은 <code>speed</code> 파라미터가 변경될 때마다 호출되며, 파라미터 값이 적절한 범위 내에 있는지 확인한 후에 값을 업데이트한다. 만약 값이 유효하지 않다면, 결과를 실패로 설정하여 파라미터 변경을 취소할 수 있다.</p>
<h4 id="_10">실시간 시스템에서의 적용</h4>
<p>실시간 시스템에서 파라미터의 변경이 시스템 성능에 미치는 영향을 최소화하기 위해서는 파라미터 변경이 처리되는 방식과 시점이 중요하다. ROS2의 QoS 정책을 적절히 설정하여, 파라미터 변경이 즉시 반영되고 노드 간의 통신에서 지연이 발생하지 않도록 해야 한다.</p>
<p>특히 실시간 시스템에서는 아래의 QoS 정책이 중요하다.</p>
<ul>
<li><strong>신뢰성(reliability)</strong>: 파라미터 변경이 중요한 경우에는 <code>Reliable</code>로 설정하여 모든 메시지가 안전하게 전달되도록 보장할 수 있다.</li>
<li><strong>내구성(durability)</strong>: 파라미터 서버에 저장된 변경 사항이 노드가 재시작하더라도 유지되어야 한다면 <code>Transient Local</code>로 설정한다.</li>
</ul>
<h4 id="_11">파라미터 변경을 통한 시스템 동작 변화</h4>
<p>파라미터가 실시간으로 변경됨에 따라 시스템 동작 역시 실시간으로 변화할 수 있다. 예를 들어, 차량의 속도를 제어하는 시스템에서는 <code>speed</code> 파라미터가 변경될 때마다 제어 알고리즘에 새로운 속도가 반영되어야 한다. 이를 상태 공간 모델로 나타내면 다음과 같다.</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathbf{x}(t+1) = \mathbf{A} \mathbf{x}(t) + \mathbf{B} \mathbf{u}(t) + \mathbf{P} \mathbf{p}(t)
</div>
<script type="math/tex; mode=display">
\mathbf{x}(t+1) = \mathbf{A} \mathbf{x}(t) + \mathbf{B} \mathbf{u}(t) + \mathbf{P} \mathbf{p}(t)
</script>
</div>
<p>위 수식에서 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{p}(t)</span><script type="math/tex">\mathbf{p}(t)</script></span>는 동적으로 변경되는 파라미터를 나타낸다. <span class="arithmatex"><span class="MathJax_Preview">\mathbf{P}</span><script type="math/tex">\mathbf{P}</script></span>는 파라미터가 시스템 상태에 미치는 영향을 나타내는 행렬이며, 이를 통해 파라미터가 시스템 동작에 직접적으로 반영된다.</p>
<h3 id="_12">동적 파라미터의 사용 사례</h3>
<p>실제 로봇 시스템에서는 파라미터를 동적으로 변경함으로써 다양한 기능을 제어할 수 있다. 예를 들어, 로봇 팔을 제어하는 시스템에서는 다음과 같은 파라미터를 동적으로 변경할 수 있다.</p>
<ul>
<li><strong>속도 제어</strong>: 로봇 팔의 이동 속도를 실시간으로 조정하여 특정 작업을 더 빠르게 또는 더 천천히 수행할 수 있다.</li>
<li><strong>궤적 변경</strong>: 작업 환경이 변화할 때 실시간으로 궤적을 수정하여 장애물을 피하거나 경로를 재설정할 수 있다.</li>
</ul>
<h4 id="_13">궤적 변경을 위한 파라미터화된 상태 공간 모델</h4>
<p>로봇 팔의 위치 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{x}(t)</span><script type="math/tex">\mathbf{x}(t)</script></span>를 제어하는 시스템에서 궤적이 파라미터화된 경우, 이를 상태 공간 모델로 표현하면 다음과 같다.</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathbf{x}(t+1) = \mathbf{A} \mathbf{x}(t) + \mathbf{B} \mathbf{u}(t) + \mathbf{P} \mathbf{p}_{\text{traj}}(t)
</div>
<script type="math/tex; mode=display">
\mathbf{x}(t+1) = \mathbf{A} \mathbf{x}(t) + \mathbf{B} \mathbf{u}(t) + \mathbf{P} \mathbf{p}_{\text{traj}}(t)
</script>
</div>
<p>여기서:
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{p}_{\text{traj}}(t)</span><script type="math/tex">\mathbf{p}_{\text{traj}}(t)</script></span>는 궤적을 정의하는 파라미터 벡터
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{P}</span><script type="math/tex">\mathbf{P}</script></span>는 궤적 파라미터가 시스템에 미치는 영향을 나타내는 행렬</p>
<p>이와 같은 파라미터화된 시스템에서는 궤적 파라미터가 변경됨에 따라 로봇의 동작 경로가 실시간으로 변화한다.</p>
<h3 id="_14">동적 파라미터와 상태 피드백</h3>
<p>파라미터가 동적으로 변경될 때, 상태 피드백을 통해 시스템의 안정성을 유지할 수 있다. 예를 들어, 속도 파라미터가 급격히 변경되었을 때 시스템이 안정적으로 동작하도록 상태 피드백을 적용할 수 있다.</p>
<p>피드백 제어 시스템의 상태 공간 모델은 다음과 같다.</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathbf{u}(t) = -\mathbf{K} \mathbf{x}(t) + \mathbf{L} \mathbf{p}(t)
</div>
<script type="math/tex; mode=display">
\mathbf{u}(t) = -\mathbf{K} \mathbf{x}(t) + \mathbf{L} \mathbf{p}(t)
</script>
</div>
<p>여기서:
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{K}</span><script type="math/tex">\mathbf{K}</script></span>는 상태 피드백 게인 행렬
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{L}</span><script type="math/tex">\mathbf{L}</script></span>는 파라미터 피드백 게인 행렬
- <span class="arithmatex"><span class="MathJax_Preview">\mathbf{p}(t)</span><script type="math/tex">\mathbf{p}(t)</script></span>는 동적으로 변경되는 파라미터</p>
<p>파라미터가 변경됨에 따라 제어 입력 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{u}(t)</span><script type="math/tex">\mathbf{u}(t)</script></span>가 동적으로 조정되고, 이를 통해 시스템의 안정성을 유지할 수 있다.</p>
<h3 id="_15">파라미터 재설정과 재구성의 실습</h3>
<p>ROS2에서는 동적 파라미터 재설정이 매우 유연하게 가능하며, 실습을 통해 이를 이해할 수 있다. 파라미터 서버를 통해 노드의 동작을 변경하는 다양한 예시가 존재하며, 이 과정에서 노드가 실행 중일 때 파라미터 값을 수정할 수 있다.</p>
<p>다음은 <code>speed</code>라는 파라미터가 있는 노드에서 동적 파라미터를 재설정하는 실습 예시이다. 이 예시는 파라미터 값을 클라이언트를 통해 동적으로 재구성한다.</p>
<h4 id="_16">파라미터 서버에서의 파라미터 재구성</h4>
<p>우선, 파라미터 서버에서 노드가 실행되는 동안 클라이언트를 사용하여 파라미터 값을 변경할 수 있다. ROS2의 명령어인 <code>ros2 param set</code>을 사용하여 이를 실습할 수 있다.</p>
<pre><code class="language-bash">ros2 param set /dynamic_node speed 15.0
</code></pre>
<p>이 명령어는 <code>/dynamic_node</code>라는 노드의 <code>speed</code> 파라미터 값을 <code>15.0</code>으로 설정한다. 노드가 실행 중일 때 이 명령어를 통해 파라미터를 변경하면, 노드에서 해당 파라미터의 값이 즉시 업데이트된다.</p>
<h4 id="_17">파라미터 설정 후 동작 확인</h4>
<p>파라미터가 설정된 후 노드가 제대로 반응하는지 확인할 수 있다. 파라미터가 변경되면, 노드 내에서 해당 파라미터와 연관된 함수들이 실행된다. 이를 위해 간단한 확인 로그를 추가할 수 있다.</p>
<pre><code class="language-cpp">RCLCPP_INFO(this-&gt;get_logger(), "New speed: %f", speed_);
</code></pre>
<p>파라미터가 변경될 때마다 위 로그 메시지가 출력되어 새로운 파라미터 값이 정상적으로 반영되었는지 확인할 수 있다.</p>
<h3 id="_18">파라미터 변경을 통한 로봇 동작 실습</h3>
<p>로봇에서 파라미터가 실시간으로 재구성되면 다양한 동작이 가능해진다. 예를 들어, 로봇 팔의 속도나 이동 경로를 실시간으로 변경하는 것은 매우 중요한 기능이다. 파라미터 변경을 통해 로봇 동작을 제어하는 예시는 다음과 같이 구현할 수 있다.</p>
<ol>
<li>
<p><strong>로봇 팔 속도 변경</strong>: 로봇 팔의 이동 속도를 <code>speed</code> 파라미터로 제어하는 경우, 속도가 변경될 때마다 로봇의 움직임이 그에 맞춰 달라진다.</p>
</li>
<li>
<p><strong>경로 재구성</strong>: 로봇의 이동 경로를 정의하는 파라미터를 동적으로 변경함으로써 경로를 실시간으로 조정할 수 있다. 이러한 설정은 장애물 회피나 비정형적인 작업 환경에서 매우 유용하다.</p>
</li>
</ol>
<h3 id="_19">파라미터의 범위 제한 및 예외 처리</h3>
<p>파라미터가 변경될 때마다 값이 유효한 범위 내에 있는지 확인하는 것이 중요하다. 예를 들어, 속도 파라미터가 음수로 설정되면 이는 물리적으로 의미가 없기 때문에, 이를 방지하기 위한 범위 제한이 필요하다.</p>
<h4 id="_20">범위 제한 예시</h4>
<pre><code class="language-cpp">if (param.get_name() == "speed") {
    if (param.as_double() &gt;= 0 &amp;&amp; param.as_double() &lt;= 100) {
        speed_ = param.as_double();
    } else {
        RCLCPP_WARN(this-&gt;get_logger(), "Invalid speed: %f", param.as_double());
        result.successful = false;
    }
}
</code></pre>
<p>위 코드는 <code>speed</code> 파라미터가 0 이상 100 이하의 범위 내에서만 변경될 수 있도록 설정한 예시이다. 만약 파라미터 값이 범위를 벗어나면 경고 메시지가 출력되고, 파라미터 변경이 실패로 처리된다.</p>
<h3 id="_21">파라미터 변경을 통한 로봇 제어의 수학적 모델링</h3>
<p>파라미터가 로봇의 제어 변수에 직접적인 영향을 미치는 경우, 이를 수학적으로 모델링하면 다음과 같다.</p>
<p>로봇 팔의 위치를 제어하는 시스템에서 속도가 파라미터로 주어질 때, 로봇의 위치 변화는 다음과 같이 표현된다.</p>
<p>$$</p>
<p>\mathbf{x}(t+1) = \mathbf{x}(t) + \mathbf{v}(t) \Delta t</p>
<p>$$</p>
<p>여기서 <span class="arithmatex"><span class="MathJax_Preview">\mathbf{v}(t)</span><script type="math/tex">\mathbf{v}(t)</script></span>는 속도 벡터이며, 이 속도는 동적으로 변경되는 파라미터 <span class="arithmatex"><span class="MathJax_Preview">p_{\text{speed}}(t)</span><script type="math/tex">p_{\text{speed}}(t)</script></span>에 의해 결정된다.</p>
<p>$$</p>
<p>\mathbf{v}(t) = p_{\text{speed}}(t) \mathbf{d}(t)</p>
<p>$$</p>
<p><span class="arithmatex"><span class="MathJax_Preview">\mathbf{d}(t)</span><script type="math/tex">\mathbf{d}(t)</script></span>는 이동 방향을 나타내는 단위 벡터이다. 따라서 속도 파라미터가 실시간으로 변경되면, 로봇의 위치가 그에 맞춰 변화한다.</p>
<h3 id="qos">동적 파라미터 시스템의 QoS 설정</h3>
<p>동적 파라미터 시스템에서 중요한 또 다른 요소는 QoS 설정이다. QoS는 노드 간 통신의 신뢰성과 내구성을 정의하며, 파라미터가 변경될 때 통신의 품질을 보장하는 역할을 한다.</p>
<p>ROS2에서 QoS 설정은 다음과 같은 요소를 포함한다.</p>
<ul>
<li>
<p><strong>신뢰성(reliability)</strong>: 파라미터가 중요한 시스템 요소라면 <code>Reliable</code>로 설정하여 파라미터 변경이 모든 노드에 확실히 전달되도록 해야 한다.</p>
</li>
<li>
<p><strong>내구성(durability)</strong>: 파라미터 값이 노드가 재시작된 후에도 유지되어야 한다면 <code>Transient Local</code>로 설정한다.</p>
</li>
</ul>
<p>파라미터의 QoS 설정 예시는 다음과 같이 작성할 수 있다.</p>
<pre><code class="language-cpp">rclcpp::QoS qos(rclcpp::KeepLast(1));
qos.reliable();
qos.transient_local();
</code></pre>
<p>이 설정은 파라미터의 변경 사항이 신뢰성 있게 전달되며, 노드가 다시 시작되어도 파라미터 값이 유지됨을 보장한다.</p>
<br/>
<div aria-label="navigation" class="row wm-article-nav-buttons" role="navigation">
<div class="wm-article-nav pull-right">
<a class="btn btn-xs btn-default pull-right" href="../1104/">
        Next
        <i aria-hidden="true" class="fa fa-chevron-right"></i>
</a>
<a class="btn btn-xs btn-link" href="../1104/">
        파라미터 변경 이벤트 처리 방법
      </a>
</div>
<div class="wm-article-nav">
<a class="btn btn-xs btn-default pull-left" href="../1102/">
<i aria-hidden="true" class="fa fa-chevron-left"></i>
        Previous</a><a class="btn btn-xs btn-link" href="../1102/">
        다중 노드 간 파라미터 공유 방법
      </a>
</div>
</div>
<br/>
</div>
<footer class="container-fluid wm-page-content">
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>