<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://booiljung.github.io/robot/autonomous_robot_with_humble_fastlivo_mid360/chapter_01/0104/" rel="canonical"/>
<link href="../../../../img/favicon.ico" rel="shortcut icon"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<title>ROS2의 패키지 관리 및 워크스페이스 설정 - 소프트웨어 융합</title>
<link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet"/>
<link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet"/>
<link href="../../../../css/base.css" rel="stylesheet"/>
<link href="../../../../css/highlight.css" rel="stylesheet"/>
<link href="../../../../css/custom.css" rel="stylesheet"/>
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<script src="../../../../js/jquery-3.2.1.min.js"></script>
<script src="../../../../js/bootstrap-3.3.7.min.js"></script>
<script src="../../../../js/highlight.pack.js"></script>
<base target="_top"/>
<script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\ud328\ud0a4\uc9c0 \uad00\ub9ac \uac1c\uc694", url: "#_top", children: [
          ]},
          {title: "\uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \uc124\uc815", url: "#_2", children: [
          ]},
          {title: "colcon \ube4c\ub4dc \ub3c4\uad6c", url: "#colcon", children: [
          ]},
          {title: "\ud328\ud0a4\uc9c0 \uc758\uc874\uc131 \uad00\ub9ac", url: "#_3", children: [
          ]},
          {title: "CMakeLists.txt \ud30c\uc77c \uad6c\uc131", url: "#cmakeliststxt", children: [
          ]},
          {title: "\uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c\uc758 \ud658\uacbd \uc124\uc815", url: "#_4", children: [
          ]},
          {title: "\ud328\ud0a4\uc9c0 \ube4c\ub4dc \ubb38\uc81c \ud574\uacb0", url: "#_5", children: [
          ]},
          {title: "\ud328\ud0a4\uc9c0\uc758 \ube4c\ub4dc \uc21c\uc11c \uad00\ub9ac", url: "#_6", children: [
              {title: "\ud328\ud0a4\uc9c0 \uc758\uc874\uc131 \uadf8\ub798\ud504", url: "#_7" },
          ]},
          {title: "\uc885\uc18d\uc131 \ud574\uacb0\uc758 \uc218\ud559\uc801 \uc811\uadfc", url: "#_8", children: [
          ]},
          {title: "colcon \ube4c\ub4dc \uba85\ub839\uc758 \uc635\uc158", url: "#colcon_1", children: [
          ]},
          {title: "\uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \uac04 \uc0c1\ud638\uc791\uc6a9", url: "#_9", children: [
              {title: "\uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \uc624\ubc84\ub808\uc774 \uc124\uc815", url: "#_10" },
          ]},
          {title: "\uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \uad6c\uc870 \ubc0f \ube4c\ub4dc \uc804\ub7b5", url: "#_11", children: [
              {title: "\uc624\ubc84\ub808\uc774 \uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \uc0ac\uc6a9 \uc608", url: "#_12" },
              {title: "\uc624\ubc84\ub808\uc774 \uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4\uc758 \ube4c\ub4dc \uc6b0\uc120\uc21c\uc704", url: "#_13" },
              {title: "\ube4c\ub4dc \uce90\uc2dc\uc640 \uc131\ub2a5 \ucd5c\uc801\ud654", url: "#_14" },
          ]},
          {title: "\uba40\ud2f0 \ud504\ub85c\uc81d\ud2b8 \ubc0f \ubcf5\uc218 \uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \uad00\ub9ac", url: "#_15", children: [
              {title: "\ud328\ud0a4\uc9c0 \ubc84\uc804 \uad00\ub9ac", url: "#_16" },
              {title: "rosdep\uc744 \uc774\uc6a9\ud55c \uc758\uc874\uc131 \uc790\ub3d9 \uc124\uce58", url: "#rosdep" },
          ]},
          {title: "\uba40\ud2f0 \uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \ub3d9\uc2dc \uc0ac\uc6a9\uc758 \ubb38\uc81c\uc810 \ubc0f \ud574\uacb0 \ubc29\ubc95", url: "#_17", children: [
          ]},
          {title: "\ub2e4\uc911 \uc6cc\ud06c\uc2a4\ud398\uc774\uc2a4 \ud658\uacbd\uc5d0\uc11c\uc758 \ub514\ubc84\uae45", url: "#_18", children: [
              {title: "\ud658\uacbd \ubcc0\uc218 \ud655\uc778", url: "#_19" },
              {title: "\uc758\uc874\uc131 \ubd84\uc11d", url: "#_20" },
              {title: "\ub178\ub4dc \ub514\ubc84\uae45", url: "#_21" },
          ]},
          {title: "colcon \uba85\ub839\uc744 \uc774\uc6a9\ud55c \ud14c\uc2a4\ud2b8 \ubc0f \ubca4\uce58\ub9c8\ud06c", url: "#colcon_2", children: [
              {title: "colcon test", url: "#colcon-test" },
              {title: "colcon test\uc758 \uace0\uae09 \uc635\uc158", url: "#colcon-test_1" },
              {title: "colcon\uc744 \uc774\uc6a9\ud55c \uc131\ub2a5 \ubd84\uc11d", url: "#colcon_3" },
          ]},
          {title: "\ud328\ud0a4\uc9c0 \ubc30\ud3ec \ubc0f \uc124\uce58", url: "#_22", children: [
              {title: "install() \uba85\ub839", url: "#install" },
          ]},
        ];

    </script>
<script src="../../../../js/base.js"></script>
<script src="../../../../js/google_analytics.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-3F4LHCTF88"></script>
</meta></head>
<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>
<div class="container-fluid wm-page-content">
<a name="_top"></a>
<div aria-label="navigation" class="row wm-article-nav-buttons" role="navigation">
<div class="wm-article-nav pull-right">
<a class="btn btn-xs btn-default pull-right" href="../0105/">
        Next
        <i aria-hidden="true" class="fa fa-chevron-right"></i>
</a>
<a class="btn btn-xs btn-link" href="../0105/">
        ROS2 통신 메커니즘 (토픽, 서비스, 액션)
      </a>
</div>
<div class="wm-article-nav">
<a class="btn btn-xs btn-default pull-left" href="../0103/">
<i aria-hidden="true" class="fa fa-chevron-left"></i>
        Previous</a><a class="btn btn-xs btn-link" href="../0103/">
        ROS2 기본 구조와 동작 원리
      </a>
</div>
</div>
<h3 id="_1">패키지 관리 개요</h3>
<p>ROS2에서 패키지 관리 시스템은 소프트웨어 모듈화를 위한 핵심 기능을 제공한다. ROS2는 여러 개의 노드로 구성된 시스템을 개발할 때, 각 노드를 패키지 단위로 관리하며, 패키지는 하나 이상의 실행 파일, 라이브러리, 메시지 정의, 서비스 정의 등을 포함할 수 있다. ROS2 패키지는 주로 <code>colcon</code> 빌드 도구를 사용하여 컴파일되고 관리된다.</p>
<p>ROS2의 패키지 관리에서 중요한 두 가지 핵심 파일은 <code>package.xml</code>과 <code>CMakeLists.txt</code>이다. <code>package.xml</code> 파일은 패키지의 메타데이터를 포함하며, 패키지의 의존성, 버전, 라이센스 정보 등을 기술한다. 반면, <code>CMakeLists.txt</code>는 빌드 절차를 정의하는 파일로, ROS2는 이 파일을 통해 패키지를 컴파일하고 링크하는 과정을 관리한다.</p>
<h3 id="_2">워크스페이스 설정</h3>
<p>ROS2 워크스페이스는 여러 개의 패키지를 포함하는 디렉토리 구조를 의미하며, 워크스페이스 내에서 패키지를 빌드, 테스트, 실행할 수 있는 환경을 제공한다. 워크스페이스 설정은 보통 다음과 같은 기본 디렉토리 구조를 따른다.</p>
<pre><code class="language-bash">&lt;workspace&gt;/
├── src/
└── install/
</code></pre>
<ul>
<li><code>src/</code> 디렉토리: 패키지의 소스 코드가 위치하는 디렉토리.</li>
<li><code>install/</code> 디렉토리: 빌드 결과물이 저장되는 디렉토리.</li>
</ul>
<p>워크스페이스를 설정하려면 <code>src/</code> 디렉토리에 패키지를 위치시키고 <code>colcon build</code> 명령을 통해 패키지를 빌드한다. 이 때, ROS2의 환경 변수를 올바르게 설정해야 한다.</p>
<h3 id="colcon">colcon 빌드 도구</h3>
<p><code>colcon</code>은 ROS2의 기본 빌드 도구로, 여러 패키지를 동시에 빌드하고, 빌드 결과를 통합 관리할 수 있게 해준다. <code>colcon build</code> 명령은 워크스페이스 내의 모든 패키지를 빌드하며, 의존성 분석을 통해 패키지 빌드 순서를 자동으로 결정한다.</p>
<pre><code class="language-bash">colcon build
</code></pre>
<p>빌드가 완료되면, 결과물은 <code>install/</code> 디렉토리에 저장된다. 이후 환경 설정을 위해 다음과 같이 ROS2 환경 변수를 설정해야 한다.</p>
<pre><code class="language-bash">source install/setup.bash
</code></pre>
<p>이 명령은 현재 터미널 세션에 ROS2 환경을 적용하여, 빌드된 패키지를 인식하게 한다.</p>
<h3 id="_3">패키지 의존성 관리</h3>
<p><code>package.xml</code> 파일은 패키지의 의존성을 관리하는 역할을 한다. 여기에는 필수 의존성(dependency), 선택적 의존성(optional dependency) 등을 정의할 수 있다. 의존성은 주로 <code>&lt;build_depend&gt;</code>, <code>&lt;exec_depend&gt;</code> 태그를 통해 설정된다.</p>
<ul>
<li><code>&lt;build_depend&gt;</code>: 패키지 빌드 과정에서 필요한 의존성.</li>
<li><code>&lt;exec_depend&gt;</code>: 패키지 실행 시 필요한 의존성.</li>
</ul>
<p>예를 들어, <code>package.xml</code>에 다음과 같은 의존성을 정의할 수 있다.</p>
<pre><code class="language-xml">&lt;build_depend&gt;rclcpp&lt;/build_depend&gt;
&lt;exec_depend&gt;std_msgs&lt;/exec_depend&gt;
</code></pre>
<p>이 경우, 패키지는 <code>rclcpp</code> 라이브러리를 빌드할 때 필요로 하며, 실행 시에는 <code>std_msgs</code> 패키지를 필요로 한다.</p>
<h3 id="cmakeliststxt">CMakeLists.txt 파일 구성</h3>
<p>ROS2에서 패키지를 빌드할 때, <code>CMakeLists.txt</code> 파일은 패키지의 빌드 규칙을 정의하는 핵심 파일이다. 이 파일은 CMake를 기반으로 하며, ROS2 패키지를 컴파일하는 규칙을 기술한다. <code>CMakeLists.txt</code>는 일반적으로 다음과 같은 기본 구조를 따른다.</p>
<pre><code class="language-cmake">cmake_minimum_required(VERSION 3.5)
project(my_ros2_package)

find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)

add_executable(my_node src/my_node.cpp)
ament_target_dependencies(my_node rclcpp)

install(TARGETS my_node
  DESTINATION lib/${PROJECT_NAME})
ament_package()
</code></pre>
<p>이 파일에서 중요한 부분은 <code>find_package()</code> 함수와 <code>ament_target_dependencies()</code> 함수이다. <code>find_package()</code> 함수는 패키지가 의존하는 라이브러리를 찾는 역할을 하며, <code>ament_target_dependencies()</code>는 컴파일 과정에서 해당 라이브러리를 사용하도록 지정한다. 마지막으로, <code>install()</code> 명령을 통해 빌드된 실행 파일이 ROS2의 표준 경로에 설치되도록 지정한다.</p>
<h3 id="_4">워크스페이스에서의 환경 설정</h3>
<p>ROS2 워크스페이스에서 패키지를 빌드한 후, 이를 시스템 환경에 반영하기 위해서는 환경 설정을 해야 한다. 기본적으로 <code>install/setup.bash</code> 스크립트를 실행하여 ROS2 환경을 현재 터미널 세션에 적용한다. 그러나 매번 터미널을 열 때마다 이 과정을 수행하는 것은 번거로울 수 있다. 이를 자동화하기 위해, 사용자는 <code>.bashrc</code> 파일에 다음 명령을 추가하여, 터미널이 열릴 때마다 자동으로 ROS2 환경이 설정되도록 할 수 있다.</p>
<pre><code class="language-bash">source ~/ros2_ws/install/setup.bash
</code></pre>
<h3 id="_5">패키지 빌드 문제 해결</h3>
<p>ROS2 패키지를 빌드하는 과정에서 발생할 수 있는 여러 문제들이 있다. 대표적인 문제는 패키지 의존성이 충돌하거나 누락된 경우이다. 이 경우 <code>colcon</code>은 다음과 같은 에러 메시지를 출력할 수 있다.</p>
<pre><code class="language-bash">Some packages failed to build:
- package_name: CMake error
</code></pre>
<p>이 문제를 해결하기 위해서는 <code>package.xml</code> 파일에서 의존성을 확인하고, 필요한 의존성 패키지가 올바르게 설치되어 있는지 확인해야 한다. 의존성 패키지가 설치되지 않은 경우, <code>rosdep</code>을 사용하여 자동으로 의존성 패키지를 설치할 수 있다.</p>
<pre><code class="language-bash">rosdep install --from-paths src --ignore-src -r -y
</code></pre>
<p>이 명령은 <code>src/</code> 디렉토리 내의 패키지들에 대한 모든 의존성을 확인하고, 누락된 패키지를 설치한다.</p>
<h3 id="_6">패키지의 빌드 순서 관리</h3>
<p><code>colcon</code>은 패키지의 빌드 순서를 자동으로 관리하지만, 때로는 의도적으로 빌드 순서를 제어해야 하는 경우가 있다. 예를 들어, 패키지 A가 패키지 B에 의존하고 있을 때, 패키지 A가 먼저 빌드되지 않도록 의존성을 명확히 지정해야 한다. 이를 위해 <code>package.xml</code> 파일의 <code>&lt;build_depend&gt;</code> 태그를 통해 의존성을 명시할 수 있다. </p>
<p>패키지 간의 의존성은 패키지 빌드 순서를 결정하는 중요한 요소이다. ROS2는 각 패키지의 의존성을 분석하여 필요한 경우 해당 패키지를 먼저 빌드한다. 예를 들어, 패키지 A가 패키지 B에 의존하는 경우, 패키지 B는 A가 빌드되기 전에 먼저 빌드되어야 한다. 이와 같은 의존성을 수학적으로 설명하면, 다음과 같이 그래프로 나타낼 수 있다.</p>
<h4 id="_7">패키지 의존성 그래프</h4>
<p>패키지 간 의존성 관계를 그래프로 나타내면, 각 패키지는 그래프의 노드로, 의존성은 노드를 연결하는 간선으로 표현할 수 있다. 예를 들어, 패키지 A가 B와 C에 의존하고, B는 D에 의존하는 경우, 이를 그래프로 나타내면 다음과 같다.</p>
<div class="mermaid">graph LR
    A --&gt; B
    A --&gt; C
    B --&gt; D
</div>
<p>이 그래프는 방향성 그래프(Directed Acyclic Graph, DAG)로, 의존성 순서를 나타낸다. 위 그래프에서 볼 수 있듯이, A를 빌드하기 위해서는 B와 C가 먼저 빌드되어야 하며, B는 D가 빌드된 후에 빌드되어야 한다. <code>colcon</code>은 이러한 의존성 그래프를 자동으로 분석하여 빌드 순서를 결정한다.</p>
<h3 id="_8">종속성 해결의 수학적 접근</h3>
<p>패키지 빌드 순서는 종속성 그래프에서의 위상 정렬(Topological Sorting) 문제로 귀결된다. 패키지 의존성 그래프를 수학적으로 표현하면, 각 패키지를 노드 <span class="arithmatex"><span class="MathJax_Preview">V</span><script type="math/tex">V</script></span>, 각 의존성을 간선 <span class="arithmatex"><span class="MathJax_Preview">E</span><script type="math/tex">E</script></span>로 하는 그래프 <span class="arithmatex"><span class="MathJax_Preview">G = (V, E)</span><script type="math/tex">G = (V, E)</script></span>를 생각할 수 있다. </p>
<p>각 패키지 <span class="arithmatex"><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span>에 대해, <span class="arithmatex"><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span>의 빌드가 완료되기 위해서는 <span class="arithmatex"><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span>에 의존하는 모든 패키지들이 먼저 빌드되어야 한다. 이를 공식적으로 표현하면 다음과 같다.</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\text{For any package } A, \text{ if } A \to B \text{, then } B \text{ must be built before } A.
</div>
<script type="math/tex; mode=display">
\text{For any package } A, \text{ if } A \to B \text{, then } B \text{ must be built before } A.
</script>
</div>
<p>이러한 종속성 그래프에서의 빌드 순서는 위상 정렬 알고리즘을 통해 결정할 수 있다. 위상 정렬은 DAG에서 모든 노드를 종속성에 따라 순차적으로 정렬하는 방법으로, 다음과 같은 단계로 진행된다.</p>
<ol>
<li>진입 차수(In-degree)가 0인 노드를 찾는다.</li>
<li>해당 노드를 빌드하고 그래프에서 제거한다.</li>
<li>남은 그래프에서 다시 진입 차수가 0인 노드를 찾고, 이를 반복한다.</li>
</ol>
<p>위상 정렬을 통해 각 패키지가 종속성에 따라 올바른 순서로 빌드될 수 있도록 한다.</p>
<h3 id="colcon_1"><code>colcon</code> 빌드 명령의 옵션</h3>
<p><code>colcon build</code> 명령에는 다양한 옵션이 있으며, 이를 통해 빌드 과정을 세밀하게 제어할 수 있다. 다음은 주요 옵션들이다.</p>
<ul>
<li><code>--packages-up-to &lt;package_name&gt;</code>: 지정한 패키지와 해당 패키지가 의존하는 패키지들까지 빌드.</li>
</ul>
<p><code>bash
  colcon build --packages-up-to my_package</code></p>
<ul>
<li><code>--packages-select &lt;package_name&gt;</code>: 특정 패키지만 빌드.</li>
</ul>
<p><code>bash
  colcon build --packages-select my_package</code></p>
<ul>
<li><code>--event-handlers console_cohesion+</code>: 빌드 로그를 실시간으로 출력하여 빌드 진행 상황을 확인할 수 있다.</li>
</ul>
<p><code>bash
  colcon build --event-handlers console_cohesion+</code></p>
<p>이 외에도 <code>colcon</code> 명령은 병렬 빌드, 캐시를 이용한 빌드 최적화 등의 다양한 기능을 제공한다.</p>
<h3 id="_9">워크스페이스 간 상호작용</h3>
<p>하나의 ROS2 워크스페이스만 사용하지 않고, 여러 개의 워크스페이스를 사용할 경우, 상호 의존하는 패키지 간의 관계를 관리하는 방법도 중요하다. 이를 위해서는 <code>overlay</code> 개념을 사용하여 여러 워크스페이스에서 정의된 패키지를 함께 사용할 수 있다.</p>
<h4 id="_10">워크스페이스 오버레이 설정</h4>
<p>오버레이 워크스페이스는 현재의 워크스페이스에서 빌드된 패키지를 다른 워크스페이스에서 사용할 수 있도록 설정하는 방법이다. 이를 설정하기 위해서는 다음 명령을 사용하여 상위 워크스페이스의 환경을 먼저 설정해야 한다.</p>
<pre><code class="language-bash">source ~/upper_ws/install/setup.bash
</code></pre>
<p>이후 하위 워크스페이스에서 패키지를 빌드하거나 실행하면 상위 워크스페이스에서 빌드된 패키지를 함께 사용할 수 있다. 이 방식은 상호 의존하는 패키지를 여러 워크스페이스에서 나누어 관리할 때 유용하다.</p>
<h3 id="_11">워크스페이스 구조 및 빌드 전략</h3>
<p>ROS2에서의 워크스페이스 설정은 단일 워크스페이스를 사용하는 방식 외에도, 여러 워크스페이스를 연결하여 효율적으로 빌드를 관리할 수 있는 방법을 제공한다. 이를 위해 "오버레이 워크스페이스"가 중요한 역할을 한다. 오버레이 워크스페이스는 하위 워크스페이스에서 상위 워크스페이스의 결과물을 참조할 수 있도록 하여, 개발 및 디버깅 환경을 더욱 유연하게 구성할 수 있다.</p>
<h4 id="_12">오버레이 워크스페이스 사용 예</h4>
<p>오버레이 워크스페이스는 여러 개의 워크스페이스가 있을 때 유용하다. 예를 들어, 하위 워크스페이스에서 새로운 기능을 개발하거나, 실험적인 코드를 추가로 빌드하고자 할 때, 이미 상위 워크스페이스에서 빌드된 코드와의 충돌 없이 추가적인 개발을 진행할 수 있다.</p>
<p>다음과 같은 절차를 통해 오버레이 워크스페이스를 설정할 수 있다.</p>
<ol>
<li>먼저 상위 워크스페이스를 빌드하고, 설치 경로를 설정한다.</li>
</ol>
<p><code>bash
   colcon build
   source ~/upper_ws/install/setup.bash</code></p>
<ol>
<li>이후 하위 워크스페이스에서 추가 패키지를 빌드할 때, 상위 워크스페이스를 오버레이하여 참조한다.</li>
</ol>
<p><code>bash
   cd ~/lower_ws/
   colcon build
   source install/setup.bash</code></p>
<p>이로써 하위 워크스페이스에서 새로운 패키지를 빌드하거나 기존 패키지를 수정하더라도, 상위 워크스페이스의 패키지들이 정상적으로 작동하며 상호 의존성을 유지할 수 있다.</p>
<h4 id="_13">오버레이 워크스페이스의 빌드 우선순위</h4>
<p>오버레이 워크스페이스를 사용할 때는, 하위 워크스페이스의 패키지가 상위 워크스페이스의 패키지를 덮어쓰는 우선순위를 가진다. 즉, 동일한 패키지가 상위와 하위 워크스페이스 모두에 존재할 경우, 하위 워크스페이스의 패키지가 우선적으로 로드된다. 이러한 특성은 새로운 버전의 패키지를 테스트하거나, 기존 패키지를 수정한 후 검증할 때 유용하다.</p>
<h4 id="_14">빌드 캐시와 성능 최적화</h4>
<p>ROS2의 <code>colcon</code> 빌드 시스템은 빌드된 결과물을 캐시로 유지하여 재빌드 시간을 단축한다. 그러나 오버레이 워크스페이스에서의 개발 과정에서는, 캐시가 잘못된 버전의 패키지를 참조할 수 있기 때문에 종종 <code>--no-cache</code> 옵션을 사용하여 빌드를 강제로 초기화할 필요가 있다.</p>
<pre><code class="language-bash">colcon build --no-cache
</code></pre>
<p>이 명령은 캐시된 빌드 정보를 무시하고 모든 패키지를 새로 빌드하도록 한다. 오버레이 워크스페이스를 사용할 때, 패키지 버전이 변경되거나 의존성에 변동이 있을 경우 이 옵션을 사용하는 것이 안전하다.</p>
<h3 id="_15">멀티 프로젝트 및 복수 워크스페이스 관리</h3>
<p>여러 개의 프로젝트나 워크스페이스를 동시에 관리하는 상황에서는 각 워크스페이스 간의 의존성과 버전을 명확하게 관리하는 것이 매우 중요하다. ROS2에서는 워크스페이스 별로 서로 다른 버전의 패키지를 사용할 수 있기 때문에, 이를 잘못 관리하면 불필요한 충돌이 발생할 수 있다.</p>
<h4 id="_16">패키지 버전 관리</h4>
<p>패키지 버전을 명확히 관리하기 위해서는 각 패키지의 <code>package.xml</code> 파일에서 버전 번호를 명시하는 것이 좋다. 패키지 버전은 다음과 같이 정의할 수 있다.</p>
<pre><code class="language-xml">&lt;version&gt;0.1.0&lt;/version&gt;
</code></pre>
<p>패키지의 버전은 <code>CMakeLists.txt</code> 파일과 함께 ROS2의 패키지 관리 시스템에서 중요한 역할을 한다. 특히, 동일한 이름의 패키지가 여러 워크스페이스에 존재할 때, 버전 번호를 통해 어떤 버전이 현재 빌드 및 사용되고 있는지 명확히 파악할 수 있다.</p>
<h4 id="rosdep"><code>rosdep</code>을 이용한 의존성 자동 설치</h4>
<p>ROS2에서 패키지를 빌드하기 전, 해당 패키지의 모든 의존성을 만족시키기 위해 <code>rosdep</code> 도구를 사용할 수 있다. 이는 특히 여러 워크스페이스에서 패키지를 설치하고 빌드할 때 매우 유용하다. <code>rosdep</code>은 <code>package.xml</code> 파일에 명시된 의존성을 분석하고, 시스템에 필요한 패키지를 자동으로 설치한다.</p>
<pre><code class="language-bash">rosdep install --from-paths src --ignore-src -r -y
</code></pre>
<p>위 명령은 <code>src/</code> 디렉토리 내의 모든 패키지를 확인하고, 빌드 및 실행에 필요한 의존성을 설치한다. 특히, 새로 생성된 워크스페이스에서 처음 빌드를 시도할 때 유용하다.</p>
<h3 id="_17">멀티 워크스페이스 동시 사용의 문제점 및 해결 방법</h3>
<p>여러 개의 워크스페이스를 사용할 때는 종종 의존성 충돌, 빌드 오류, 실행 시 문제 등이 발생할 수 있다. 특히, 상위 워크스페이스에서 이미 빌드된 패키지가 하위 워크스페이스에서 새로 빌드된 패키지와 충돌하는 상황이 자주 발생한다. 이러한 문제를 해결하기 위해서는 다음과 같은 방법을 사용할 수 있다.</p>
<ol>
<li>
<p><strong>명확한 빌드 순서 유지</strong>: 의존성이 있는 패키지들을 빌드할 때는 반드시 상위 워크스페이스의 패키지를 먼저 빌드하고, 이후 하위 워크스페이스의 패키지를 빌드해야 한다. 이 때 의존성 순서를 엄격하게 관리하는 것이 중요하다.</p>
</li>
<li>
<p><strong>패키지 설치 경로의 명확화</strong>: 각 워크스페이스에서 패키지가 설치되는 경로를 명확히 구분하여, 실행 시 환경 변수에 설정된 경로에서 올바른 패키지가 로드되도록 해야 한다. </p>
</li>
<li>
<p><strong>의존성 충돌 해결</strong>: 상위와 하위 워크스페이스 간의 패키지 충돌이 발생할 경우, 의존성을 확인하고, 불필요한 패키지를 제거하거나, 상위 워크스페이스에서 특정 패키지를 무시하도록 설정할 수 있다.</p>
</li>
<li>
<p><strong>테스트 환경 분리</strong>: 새로운 패키지나 기능을 테스트할 때는, 기존 환경과 격리된 테스트 워크스페이스를 사용하여 실험적인 코드를 검증할 수 있다. 이를 통해 기존 시스템에 미치는 영향을 최소화할 수 있다.</p>
</li>
</ol>
<h3 id="_18">다중 워크스페이스 환경에서의 디버깅</h3>
<p>다중 워크스페이스 환경에서는 여러 워크스페이스 간의 패키지 간섭 및 충돌이 발생할 수 있으므로, 디버깅 과정에서 이러한 문제를 빠르게 파악하고 해결하는 것이 중요하다. ROS2에서 제공하는 디버깅 도구 및 방법을 이용하면 패키지 의존성, 환경 변수 설정, 빌드 오류 등을 효과적으로 해결할 수 있다.</p>
<h4 id="_19">환경 변수 확인</h4>
<p>ROS2는 실행 시 여러 환경 변수를 사용하여 패키지를 관리한다. 특히, <code>ROS_PACKAGE_PATH</code>와 같은 환경 변수가 올바르게 설정되지 않으면 특정 패키지가 정상적으로 로드되지 않거나 실행되지 않는 문제가 발생할 수 있다. 따라서 각 워크스페이스에서 빌드를 수행한 후 환경 변수를 제대로 설정했는지 확인해야 한다.</p>
<p>다음 명령을 사용하여 현재 설정된 환경 변수를 확인할 수 있다.</p>
<pre><code class="language-bash">echo $ROS_PACKAGE_PATH
</code></pre>
<p>이 명령은 현재 터미널 세션에서 사용 중인 패키지 경로를 출력하며, 워크스페이스에서 설치된 패키지들이 올바르게 참조되고 있는지 확인할 수 있다. <code>ROS_PACKAGE_PATH</code>는 여러 워크스페이스를 오버레이하여 사용할 때 필수적으로 확인해야 하는 변수 중 하나다.</p>
<h4 id="_20">의존성 분석</h4>
<p>다중 워크스페이스에서 발생하는 문제의 원인은 주로 패키지 간 의존성 불일치에 기인할 수 있다. ROS2에서는 패키지 의존성을 확인하는 데 유용한 <code>ros2 pkg</code> 명령을 제공한다. 예를 들어, 특정 패키지의 의존성을 확인하려면 다음과 같이 사용할 수 있다.</p>
<pre><code class="language-bash">ros2 pkg dependencies &lt;패키지_이름&gt;
</code></pre>
<p>이 명령은 해당 패키지가 의존하고 있는 모든 패키지를 나열하며, 이를 통해 누락된 의존성이나 충돌하는 패키지를 빠르게 파악할 수 있다. 또한, 패키지 간 의존성 그래프를 사용하여 빌드 순서나 종속 관계를 시각적으로 확인할 수 있다.</p>
<h4 id="_21">노드 디버깅</h4>
<p>ROS2는 각 노드를 별도로 디버깅할 수 있는 환경을 제공한다. 노드 실행 시, 특정 노드가 정상적으로 작동하지 않거나 에러를 발생시킬 경우, <code>ros2 run</code> 명령을 통해 개별적으로 실행하고 에러 로그를 확인하는 방식으로 디버깅할 수 있다.</p>
<p>예를 들어, <code>my_node</code>라는 이름의 노드를 디버깅하려면 다음과 같이 실행한다.</p>
<pre><code class="language-bash">ros2 run &lt;패키지_이름&gt; my_node
</code></pre>
<p>에러 메시지나 경고가 발생하면 해당 메시지를 참고하여 문제를 분석할 수 있다. 추가적으로, 노드 실행 시 <code>--log-level</code> 옵션을 사용하여 로그 출력의 상세 수준을 조정할 수 있다.</p>
<pre><code class="language-bash">ros2 run &lt;패키지_이름&gt; my_node --ros-args --log-level DEBUG
</code></pre>
<p>이 명령은 디버깅을 위해 로그 레벨을 <code>DEBUG</code>로 설정하여 더 많은 정보를 제공한다.</p>
<h3 id="colcon_2">colcon 명령을 이용한 테스트 및 벤치마크</h3>
<p>패키지를 빌드한 후, <code>colcon</code>은 패키지에 대한 자동화된 테스트 기능을 제공한다. 패키지가 정상적으로 빌드된 후에도 예상치 못한 문제가 발생할 수 있기 때문에, 테스트를 통해 빌드된 패키지의 기능을 확인하는 것이 중요하다.</p>
<h4 id="colcon-test">colcon test</h4>
<p><code>colcon</code>은 빌드된 패키지에 대해 정의된 테스트를 자동으로 수행할 수 있다. 테스트는 패키지 내에서 미리 정의된 테스트 코드에 의해 수행되며, 다음 명령을 통해 실행할 수 있다.</p>
<pre><code class="language-bash">colcon test
</code></pre>
<p>이 명령은 워크스페이스 내의 모든 패키지에 대해 테스트를 수행하며, 테스트 결과를 콘솔에 출력한다. 또한, 테스트 후 결과를 요약하여 보여주는 <code>colcon test-result</code> 명령을 사용할 수 있다.</p>
<pre><code class="language-bash">colcon test-result
</code></pre>
<p>이 명령은 패키지 별 테스트 결과를 요약하여, 성공 또는 실패한 테스트 케이스를 보여준다. 실패한 테스트가 있을 경우, 테스트 로그를 확인하여 문제를 해결할 수 있다.</p>
<h4 id="colcon-test_1">colcon test의 고급 옵션</h4>
<p><code>colcon</code>의 테스트 명령은 다양한 옵션을 통해 테스트의 범위와 방법을 조정할 수 있다. 예를 들어, 특정 패키지에 대해서만 테스트를 실행하거나, 특정 테스트를 제외한 나머지 테스트를 실행할 수도 있다.</p>
<ul>
<li>특정 패키지에 대한 테스트 실행:</li>
</ul>
<p><code>bash
  colcon test --packages-select &lt;패키지_이름&gt;</code></p>
<ul>
<li>테스트 중간에 실패한 테스트가 발생할 경우 즉시 중단:</li>
</ul>
<p><code>bash
  colcon test --event-handlers console_direct+</code></p>
<p>이 명령은 테스트가 실패하면 바로 중단하여 문제를 빠르게 파악할 수 있도록 한다.</p>
<h4 id="colcon_3">colcon을 이용한 성능 분석</h4>
<p>ROS2에서는 빌드된 패키지나 노드의 성능을 측정하고 최적화하기 위한 다양한 도구들을 제공한다. 특히 <code>colcon</code> 명령과 ROS2 내장 프로파일링 도구를 활용하여 노드의 성능을 측정하고 병목 지점을 분석할 수 있다.</p>
<p>노드의 성능을 측정하려면 실행 시 성능 측정 옵션을 활성화할 수 있다.</p>
<pre><code class="language-bash">ros2 run &lt;패키지_이름&gt; &lt;노드_이름&gt; --ros-args --enable-performance-measurements
</code></pre>
<p>이 명령은 노드 실행 시 성능 데이터를 수집하여, 각 노드의 처리 시간, 메시지 전송 지연 시간 등을 분석할 수 있다. 수집된 성능 데이터는 이후 분석 및 최적화를 위한 기초 자료로 사용된다.</p>
<h3 id="_22">패키지 배포 및 설치</h3>
<p>ROS2에서 패키지를 배포할 때는 빌드된 패키지를 표준 설치 경로로 복사하여 다른 시스템에서 사용할 수 있도록 해야 한다. ROS2 패키지는 <code>colcon</code> 빌드 시스템을 통해 쉽게 배포할 수 있으며, 패키지를 설치할 때는 <code>install()</code> 명령을 사용하여 빌드된 실행 파일 및 라이브러리를 ROS2 표준 경로로 복사한다.</p>
<h4 id="install">install() 명령</h4>
<p>패키지를 빌드하고 설치하기 위해서는 <code>CMakeLists.txt</code> 파일에 <code>install()</code> 명령을 추가해야 한다. 예를 들어, <code>my_node</code>라는 실행 파일을 설치하려면 다음과 같이 설정할 수 있다.</p>
<pre><code class="language-cmake">install(TARGETS my_node
  DESTINATION lib/${PROJECT_NAME})
</code></pre>
<p>이 설정은 빌드된 실행 파일을 ROS2의 표준 설치 경로에 복사하여, 다른 패키지나 노드에서 해당 실행 파일을 참조할 수 있도록 한다. 이후 <code>colcon build</code> 명령을 실행하면, 패키지가 설치되고 환경 변수 설정을 통해 참조할 수 있게 된다.</p>
<pre><code class="language-bash">source install/setup.bash
</code></pre>
<p>이 명령을 실행하여 설치된 패키지의 경로를 활성화한 후, 다른 노드나 패키지에서 해당 실행 파일을 실행하거나 의존성을 참조할 수 있다.</p>
<br/>
<div aria-label="navigation" class="row wm-article-nav-buttons" role="navigation">
<div class="wm-article-nav pull-right">
<a class="btn btn-xs btn-default pull-right" href="../0105/">
        Next
        <i aria-hidden="true" class="fa fa-chevron-right"></i>
</a>
<a class="btn btn-xs btn-link" href="../0105/">
        ROS2 통신 메커니즘 (토픽, 서비스, 액션)
      </a>
</div>
<div class="wm-article-nav">
<a class="btn btn-xs btn-default pull-left" href="../0103/">
<i aria-hidden="true" class="fa fa-chevron-left"></i>
        Previous</a><a class="btn btn-xs btn-link" href="../0103/">
        ROS2 기본 구조와 동작 원리
      </a>
</div>
</div>
<br/>
</div>
<footer class="container-fluid wm-page-content">
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>