<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://booiljung.github.io/artificial_intelligent/chatgpt_api/chapter_12/1202/">
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>주요 코드 스니펫 모음 - 소프트웨어 융합</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <link href="../../../../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "OpenAI API \uae30\ubcf8 \uc124\uc815", url: "#_top", children: [
          ]},
          {title: "\ud504\ub86c\ud504\ud2b8 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \uae30\ucd08", url: "#_1", children: [
          ]},
          {title: "\ub300\ud654\ud615 \uc694\uccad \ubc0f \uc0c1\ud0dc \uad00\ub9ac", url: "#_2", children: [
          ]},
          {title: "\ub2e4\uc911 \ubaa8\ub378 \uc0ac\uc6a9 \uc804\ub7b5", url: "#_3", children: [
          ]},
          {title: "\uc624\ub958 \ucc98\ub9ac \ubc0f \uc608\uc678 \uad00\ub9ac", url: "#_4", children: [
          ]},
          {title: "\ub124\ud2b8\uc6cc\ud06c \uc624\ub958 \ubc0f \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1 \uad6c\ud604", url: "#_5", children: [
          ]},
          {title: "\uc694\uccad \ud30c\ub77c\ubbf8\ud130 \ucd5c\uc801\ud654", url: "#_6", children: [
          ]},
          {title: "\ubcf5\uc7a1\ud55c \ud504\ub86c\ud504\ud2b8 \uc791\uc131 \uc804\ub7b5", url: "#_7", children: [
          ]},
          {title: "API \uc751\ub2f5 \ub370\uc774\ud130 \ud30c\uc2f1 \ubc0f \ucc98\ub9ac", url: "#api", children: [
          ]},
          {title: "\ub2e4\uc911 \uc751\ub2f5 \uc0dd\uc131 \ubc0f \uc120\ud0dd", url: "#_8", children: [
          ]},
          {title: "\ub300\uaddc\ubaa8 \uc694\uccad \ucc98\ub9ac \ubc0f Rate Limit \uad00\ub9ac", url: "#rate-limit", children: [
          ]},
          {title: "\uce90\uc2f1\uc744 \ud65c\uc6a9\ud55c \uc131\ub2a5 \ucd5c\uc801\ud654", url: "#_9", children: [
          ]},
          {title: "\uc790\ub3d9\ud654\ub41c \uace0\uac1d \uc9c0\uc6d0 \uc2dc\uc2a4\ud15c \uad6c\ud604", url: "#_10", children: [
          ]},
          {title: "\uc0dd\uc131\ub41c \ud14d\uc2a4\ud2b8 \uae30\ubc18 \ub370\uc774\ud130 \ubd84\uc11d", url: "#_11", children: [
          ]},
          {title: "\ub300\ud654\ud615 \ubd07 \uc81c\uc791", url: "#_12", children: [
          ]},
          {title: "\ube44\uc6a9 \ud6a8\uc728\uc801\uc778 API \uc0ac\uc6a9 \uc804\ub7b5", url: "#api_1", children: [
          ]},
          {title: "\uc720\ub2db \ud14c\uc2a4\ud2b8 \ubc0f \ud1b5\ud569 \ud14c\uc2a4\ud2b8", url: "#_13", children: [
          ]},
          {title: "API \uc751\ub2f5 \uc2dc\uac04 \ucd5c\uc801\ud654", url: "#api_2", children: [
          ]},
          {title: "\uc9c0\uc18d\uc801 \ud1b5\ud569(CI) \ubc0f \uc9c0\uc18d\uc801 \ubc30\ud3ec(CD) \uc124\uc815", url: "#ci-cd", children: [
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../js/google_analytics.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="https://www.googletagmanager.com/gtag/js?id=G-3F4LHCTF88"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1203/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1203/" class="btn btn-xs btn-link">
        일반적인 문제와 해결 방법 FAQ
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1201/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1201/" class="btn btn-xs btn-link">
        OpenAI API 공식 문서 해설
      </a>
    </div>
    
  </div>

    

    <h3 id="openai-api">OpenAI API 기본 설정</h3>
<p>ChatGPT API를 사용하기 위해 OpenAI의 Python 라이브러리를 설치하고 API 키를 설정하는 기본 코드이다.</p>
<pre><code class="language-python">import openai

openai.api_key = 'your-api-key'

response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=&quot;Hello, how are you?&quot;,
    max_tokens=50
)

print(response.choices[0].text.strip())
</code></pre>
<h3 id="_1">프롬프트 엔지니어링 기초</h3>
<p>프롬프트에 따라 API가 생성하는 텍스트 결과가 달라질 수 있다. 다음은 다양한 프롬프트를 사용하는 예시이다.</p>
<pre><code class="language-python">prompt = &quot;What is the capital of France?&quot;

response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=prompt,
    max_tokens=50
)

print(response.choices[0].text.strip())
</code></pre>
<h3 id="_2">대화형 요청 및 상태 관리</h3>
<p>대화를 이어 나가기 위해 대화의 상태를 유지하는 예시이다.</p>
<pre><code class="language-python">conversation_history = [
    {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;},
    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the weather like today?&quot;}
]

response = openai.ChatCompletion.create(
    model=&quot;gpt-4&quot;,
    messages=conversation_history
)

conversation_history.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: response['choices'][0]['message']['content']})

print(response['choices'][0]['message']['content'])
</code></pre>
<h3 id="_3">다중 모델 사용 전략</h3>
<p>여러 모델을 동시에 사용하여 다양한 결과를 비교하거나 병렬로 작업을 처리할 수 있다. </p>
<pre><code class="language-python">models = [&quot;text-davinci-003&quot;, &quot;gpt-4&quot;]

for model in models:
    response = openai.Completion.create(
        engine=model,
        prompt=&quot;Explain quantum computing in simple terms.&quot;,
        max_tokens=100
    )
    print(f&quot;Model: {model}&quot;)
    print(response.choices[0].text.strip())
    print(&quot;\n&quot;)
</code></pre>
<h3 id="_4">오류 처리 및 예외 관리</h3>
<p>API 호출 중 발생할 수 있는 오류를 처리하는 방법을 보여주는 예시이다.</p>
<pre><code class="language-python">import openai
import time

openai.api_key = 'your-api-key'

def call_openai_api(prompt):
    try:
        response = openai.Completion.create(
            engine=&quot;text-davinci-003&quot;,
            prompt=prompt,
            max_tokens=50
        )
        return response.choices[0].text.strip()
    except openai.error.RateLimitError:
        print(&quot;Rate limit exceeded. Retrying in 5 seconds...&quot;)
        time.sleep(5)
        return call_openai_api(prompt)  # 재시도
    except Exception as e:
        print(f&quot;An error occurred: {e}&quot;)
        return None

result = call_openai_api(&quot;Tell me a joke.&quot;)
print(result)
</code></pre>
<h3 id="_5">네트워크 오류 및 재시도 로직 구현</h3>
<p>네트워크 오류가 발생할 경우 자동으로 재시도하는 로직을 구현하는 예시이다.</p>
<pre><code class="language-python">import requests
import time

def api_request_with_retry(url, max_retries=3):
    retries = 0
    while retries &lt; max_retries:
        try:
            response = requests.get(url)
            response.raise_for_status()  # 상태 코드가 200이 아닌 경우 예외 발생
            return response.json()
        except requests.exceptions.RequestException as e:
            print(f&quot;Request failed: {e}. Retrying...&quot;)
            retries += 1
            time.sleep(2)  # 재시도 간격
    return None

result = api_request_with_retry(&quot;https://api.example.com/data&quot;)
if result:
    print(result)
else:
    print(&quot;Failed to fetch data after retries.&quot;)
</code></pre>
<h3 id="_6">요청 파라미터 최적화</h3>
<p>요청 시 사용하는 다양한 파라미터를 통해 결과를 최적화할 수 있다. 예를 들어, <code>temperature</code> 값은 생성되는 텍스트의 창의성을 제어한다.</p>
<pre><code class="language-python">response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=&quot;Write a creative story about a dragon and a knight.&quot;,
    max_tokens=150,
    temperature=0.7,  # 창의성 정도
    top_p=1,          # 확률 샘플링의 범위
    frequency_penalty=0.5,  # 반복 억제
    presence_penalty=0.5    # 새로운 주제 유도
)

print(response.choices[0].text.strip())
</code></pre>
<h3 id="_7">복잡한 프롬프트 작성 전략</h3>
<p>복잡한 프롬프트를 사용하여 특정한 형식이나 패턴을 유도하는 전략이다.</p>
<pre><code class="language-python">prompt = &quot;&quot;&quot;
You are a world-class editor. Edit the following paragraph for clarity and precision:
---
The quick brown fox jumps over the lazy dog. It is a sentence that contains every letter of the alphabet, 
which makes it useful for testing fonts and keyboards. The dog, however, does not seem to mind.
---
Please rewrite the paragraph to be more concise and engaging.
&quot;&quot;&quot;

response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=prompt,
    max_tokens=150
)

print(response.choices[0].text.strip())
</code></pre>
<h3 id="api">API 응답 데이터 파싱 및 처리</h3>
<p>API 응답 데이터를 처리하고 필요한 부분만 추출하는 코드이다.</p>
<pre><code class="language-python">response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=&quot;Summarize the following text: The quick brown fox jumps over the lazy dog.&quot;,
    max_tokens=50
)

generated_text = response.choices[0].text.strip()
print(f&quot;Summary: {generated_text}&quot;)

import json
print(json.dumps(response, indent=4))
</code></pre>
<h3 id="_8">다중 응답 생성 및 선택</h3>
<p>여러 응답을 생성하고 그 중 하나를 선택하는 방법이다.</p>
<pre><code class="language-python">response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=&quot;Give me three different ways to explain AI to a 5-year-old.&quot;,
    max_tokens=150,
    n=3  # 3개의 응답 생성
)

for idx, choice in enumerate(response.choices):
    print(f&quot;Option {idx+1}: {choice.text.strip()}&quot;)
</code></pre>
<h3 id="rate-limit">대규모 요청 처리 및 Rate Limit 관리</h3>
<p>대규모 요청을 처리하는 예시로, Rate Limit을 관리하는 방법을 포함한다.</p>
<pre><code class="language-python">import openai
import time

def call_openai_in_batches(prompts, batch_size=5):
    results = []
    for i in range(0, len(prompts), batch_size):
        batch = prompts[i:i+batch_size]
        try:
            responses = openai.Completion.create(
                engine=&quot;text-davinci-003&quot;,
                prompt=batch,
                max_tokens=100
            )
            results.extend([choice.text.strip() for choice in responses.choices])
        except openai.error.RateLimitError:
            print(&quot;Rate limit hit. Waiting for 10 seconds...&quot;)
            time.sleep(10)  # Rate limit을 초과할 경우 대기 후 재시도
        except Exception as e:
            print(f&quot;An error occurred: {e}&quot;)
    return results

prompts = [&quot;Explain AI.&quot;, &quot;What is the capital of France?&quot;, &quot;How does a car engine work?&quot;]
responses = call_openai_in_batches(prompts)
print(responses)
</code></pre>
<h3 id="_9">캐싱을 활용한 성능 최적화</h3>
<p>같은 요청에 대한 결과를 캐싱하여 성능을 최적화하는 방법이다.</p>
<pre><code class="language-python">import openai
import hashlib

cache = {}

def get_response_with_cache(prompt):
    prompt_hash = hashlib.md5(prompt.encode()).hexdigest()

    # 캐시 확인
    if prompt_hash in cache:
        print(&quot;Returning cached result.&quot;)
        return cache[prompt_hash]

    # API 호출
    response = openai.Completion.create(
        engine=&quot;text-davinci-003&quot;,
        prompt=prompt,
        max_tokens=100
    )

    # 캐시에 저장
    result = response.choices[0].text.strip()
    cache[prompt_hash] = result
    return result

response1 = get_response_with_cache(&quot;Tell me a joke.&quot;)
print(response1)

response2 = get_response_with_cache(&quot;Tell me a joke.&quot;)
print(response2)
</code></pre>
<h3 id="_10">자동화된 고객 지원 시스템 구현</h3>
<p>ChatGPT API를 사용하여 자동화된 고객 지원 챗봇을 구현하는 기본 예시이다.</p>
<pre><code class="language-python">conversation_history = [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a customer support bot for an online store.&quot;}]

def get_customer_support_response(user_input):
    conversation_history.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input})

    response = openai.ChatCompletion.create(
        model=&quot;gpt-4&quot;,
        messages=conversation_history
    )

    # 대화 기록에 봇의 응답 추가
    bot_response = response['choices'][0]['message']['content']
    conversation_history.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: bot_response})

    return bot_response

user_input = &quot;I need help with my order.&quot;
bot_response = get_customer_support_response(user_input)
print(bot_response)
</code></pre>
<h3 id="_11">생성된 텍스트 기반 데이터 분석</h3>
<p>생성된 텍스트 데이터를 분석하여 유용한 정보를 추출하는 방법을 보여준다.</p>
<pre><code class="language-python">import openai

response = openai.Completion.create(
    engine=&quot;text-davinci-003&quot;,
    prompt=&quot;Generate a paragraph about the benefits of exercise.&quot;,
    max_tokens=100
)

generated_text = response.choices[0].text.strip()

from collections import Counter
import re

# 단어 추출
words = re.findall(r'\b\w+\b', generated_text.lower())
word_count = Counter(words)

# 가장 자주 등장한 단어 출력
print(word_count.most_common(5))
</code></pre>
<h3 id="_12">대화형 봇 제작</h3>
<p>사용자와의 대화 흐름을 관리하는 대화형 봇을 제작하는 코드이다.</p>
<pre><code class="language-python">import openai

conversation_history = [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a friendly chatbot.&quot;}]

def chatbot(user_input):
    conversation_history.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input})

    response = openai.ChatCompletion.create(
        model=&quot;gpt-4&quot;,
        messages=conversation_history
    )

    bot_message = response['choices'][0]['message']['content']
    conversation_history.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: bot_message})

    return bot_message

# 사용자와 대화 시뮬레이션
while True:
    user_input = input(&quot;You: &quot;)
    if user_input.lower() == &quot;exit&quot;:
        break
    bot_response = chatbot(user_input)
    print(f&quot;Bot: {bot_response}&quot;)
</code></pre>
<h3 id="api_1">비용 효율적인 API 사용 전략</h3>
<p>API 사용량을 줄이면서 효율적인 방법으로 결과를 얻는 전략이다. <code>max_tokens</code>, <code>temperature</code> 등의 파라미터를 적절하게 조절하여 비용을 절감할 수 있다.</p>
<pre><code class="language-python">def generate_text(prompt, max_tokens=50, temperature=0.5):
    response = openai.Completion.create(
        engine=&quot;text-davinci-003&quot;,
        prompt=prompt,
        max_tokens=max_tokens,   # 생성할 토큰 수 제한
        temperature=temperature  # 창의성 조절
    )
    return response.choices[0].text.strip()

# 최대 30개의 토큰만 생성
result = generate_text(&quot;Describe the importance of sleep.&quot;, max_tokens=30)
print(result)
</code></pre>
<h3 id="_13">유닛 테스트 및 통합 테스트</h3>
<p>API 호출을 테스트하는 유닛 테스트 작성법이다.</p>
<pre><code class="language-python">import unittest
from unittest.mock import patch
import openai

class TestOpenAIAPI(unittest.TestCase):

    @patch('openai.Completion.create')
    def test_generate_text(self, mock_create):
        # 가짜 응답 정의
        mock_create.return_value = {
            'choices': [{'text': 'Hello, world!'}]
        }

        result = openai.Completion.create(
            engine=&quot;text-davinci-003&quot;,
            prompt=&quot;Say hello&quot;,
            max_tokens=5
        )

        self.assertEqual(result['choices'][0]['text'], 'Hello, world!')

if __name__ == '__main__':
    unittest.main()
</code></pre>
<h3 id="api_2">API 응답 시간 최적화</h3>
<p>API 응답 시간을 최적화하기 위한 방법으로, 필요한 최소한의 파라미터만 사용하고 요청 크기를 줄이는 방법을 제시한다.</p>
<pre><code class="language-python">def optimized_request(prompt):
    response = openai.Completion.create(
        engine=&quot;text-davinci-003&quot;,
        prompt=prompt,
        max_tokens=50,
        temperature=0.3,  # 낮은 창의성으로 빠른 응답
        n=1,              # 응답 1개만 생성
        stream=False      # 스트리밍 비활성화
    )
    return response.choices[0].text.strip()

# 최적화된 요청 실행
result = optimized_request(&quot;Explain the concept of gravity in simple terms.&quot;)
print(result)
</code></pre>
<h3 id="ci-cd">지속적 통합(CI) 및 지속적 배포(CD) 설정</h3>
<p>CI/CD 파이프라인에서 API를 사용하는 테스트를 설정하는 기본 방법이다.</p>
<pre><code class="language-yaml"># .github/workflows/test_openai_api.yml

name: Test OpenAI API

on:
  push:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
      - name: Run tests
        run: |
          python -m unittest discover -s tests
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../1203/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../1203/" class="btn btn-xs btn-link">
        일반적인 문제와 해결 방법 FAQ
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1201/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1201/" class="btn btn-xs btn-link">
        OpenAI API 공식 문서 해설
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>